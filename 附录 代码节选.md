# 附录 代码节选

**部分代码本小组已经开源 请查询 https://github.com/sogeisetsu/shumeipai   现附上代码节选**

## 前端

### login.html

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
    <title>登录</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- jQuery (Bootstrap 的所有 JavaScript 插件都依赖 jQuery，所以必须放在前边) -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
    <!-- 加载 Bootstrap 的所有 JavaScript 插件。你也可以根据需要只加载单个插件。 -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js"></script>
    <script src="js/jquery.serializejson.js"></script>


    <style>
        body{
            padding-top: 45px !important;
            /*padding-bottom: 70px;*/
        }
        .jumbotron{
            background: url("img/reg_bg_min.jpg");
            background-size: cover;
        }
        .jumbotron h1,.jumbotron h2{
            color: snow;
        }
        .jumbotron strong{
            color: #bcccc2;
        }
        .jumbotron h2 small{
            color: rgba(210, 218, 225, 0.83);
        }
        /*.fa-chevron-right:before {*/
        /*    content: "";*/
        /*}*/
    </style>
    <link rel="stylesheet" href="css/login.css">

    <script>
        $(function () {
            function checkUsername() {
                //1.获取用户名值
                var username = $("#lg_username").val();
                //2.定义正则
                var reg_username = /^\w{8,20}$/;

                //3.判断，给出提示信息
                var flag = reg_username.test(username);
                if(flag){
                    //用户名合法
                    $("#lg_username").css("border","");
                    $('#error_username').text("");
                }else{
                    //用户名非法,加一个红色边框
                    $("#lg_username").css("border","1px solid red");
                    $('#error_username').css({"color":"red"}).html("用户名格式错误");
                    // $('#error_username').parent().css({"width":"70px"})
                }

                return flag;
            }
            function checkPassword() {
                //1.获取用户名值
                var password = $("#lg_password").val();
                //2.定义正则
                var reg_password = /^\w{8,20}$/;

                //3.判断，给出提示信息
                var flag = reg_password.test(password);
                if(flag){
                    //用户名合法
                    $("#lg_password").css("border","");
                    $('#error_password').text("");
                }else{
                    //用户名非法,加一个红色边框
                    $("#lg_password").css("border","1px solid red");
                    $('#error_password').css({"color":"red"}).html("格式错误");
                    // $('#error_password').parent().css({"width":"70px"})
                }

                return flag;
            }

            $('#tbutton').click(function () {
                if (checkUsername()&&checkUsername()) {
                    $('#errorMsg').css({"color":"red"}).html('<p>登陆中……</p>');
                    $.ajax({
                        url: "/login",
                        type: "post",
                        contentType: "application/json;charset=UTF-8",
                        data: JSON.stringify($('#login-form').serializeJSON()),
                        success: function (data) {
                            console.log(data);
                            if(data.flag==false){
                                $('#errorMsg').css({"background":"blue","color":"red"}).html(data.errorMsg);
                            }else {
                                $('#errorMsg').css({"background":"","color":"blue"}).html("登录成功");
                            }
                        }
                    })
                }
            });
            $('#lg_username').blur(checkUsername);
            $('#lg_password').blur(checkPassword);
        })
    </script>
</head>
<body>
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">
                <img src="img/1168148.png" height="30px">
            </a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav">
                <li ><a href="#">当前作物信息</a></li>
                <li><a href="#">视频直播</a></li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">历史信息<span class="caret"></span></a>
                    <ul class="dropdown-menu">
                        <li><a href="#">历史环境信息总表</a></li>
                        <li><a href="#">历史空气温湿度表</a></li>
                        <li><a href="#">历史土壤湿度表</a></li>
                        <li><a href="#">历史光照强度表</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">历史操作记录</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">历史提醒记录</a></li>
                    </ul>
                </li>
            </ul>
            <form class="navbar-form navbar-left">
                <div class="form-group">
                    <input type="text" class="form-control" placeholder="快速检索">
                </div>
                <button type="submit" class="btn btn-default">搜索</button>
            </form>
            <ul class="nav navbar-nav navbar-right">
                <li><a href="http://106.14.162.154:82/">控制台</a></li>
                <li><a href="#">设置</a></li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">用户 <span class="caret"></span></a>
                    <ul class="dropdown-menu">
                        <li><a href="#">详细信息</a></li>
                        <li><a href="#">成员管理</a></li>
                        <li><a href=regist.html>注册</a></li>
                        <li><a href=login.html>登录</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">登出</a></li>
                    </ul>
                </li>
            </ul>
        </div><!-- /.navbar-collapse -->
    </div><!-- /.container-fluid -->
</nav>
<div class="container-fluid">
    <div class="jumbotron">
        <h1>节能减排小组DEMO</h1>
        <p><strong>This is a simple hero unit, a simple jumbotron-style component for calling extra attention to featured
            content or information.</strong></p>
        <h2>用科技 <small>让世界更简单</small></h2>
        <p><a class="btn btn-primary btn-lg" href="#" role="button">Learn more</a></p>
    </div>
</div>
<div class="text-center" style="padding:50px 0">
    <div class="logo">login</div>
    <!-- Main Form -->
    <div class="login-form-1">
        <form id="login-form" class="text-left">
            <div id="errorMsg"></div>
            <div class="login-form-main-message"></div>
            <div class="main-login-form">
                <div class="login-group">
                    <div class="form-group">
                        <label for="lg_username" class="sr-only">Username</label>
                        <input type="text" class="form-control" id="lg_username" name="username" placeholder="username">
                        <p id="error_username"></p>
                    </div>
                    <div class="form-group">
                        <label for="lg_password" class="sr-only">Password</label>
                        <input type="password" class="form-control" id="lg_password" name="password" placeholder="password">
                        <p id="error_password"></p>
                    </div>
                    <div class="form-group login-group-checkbox">
                        <input type="checkbox" id="lg_remember" name="lg_remember">
                        <label for="lg_remember">remember</label>
                    </div>
                </div>
                <input  class="login-button" id="tbutton" type="button" value=" 》"></input>
            </div>
            <div class="etc-login-form">
                <p>forgot your password? <a href="#">click here</a></p>
                <p>new user? <a href="#">create new account</a></p>
            </div>
        </form>
    </div>
    <!-- end:Main Form -->
</div></body>
</html>
```

### regist.html

```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
    <title>注册</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- jQuery (Bootstrap 的所有 JavaScript 插件都依赖 jQuery，所以必须放在前边) -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
    <!-- 加载 Bootstrap 的所有 JavaScript 插件。你也可以根据需要只加载单个插件。 -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js"></script>
    <script src="js/jquery.serializejson.js"></script>

    <style>
        body{
            padding-top: 55px;
            /*padding-bottom: 70px;*/
        }
        .jumbotron{
            background: url("img/reg_bg_min.jpg");
            background-size: cover;
        }
        .jumbotron h1,.jumbotron h2{
            color: snow;
        }
        .jumbotron strong{
            color: #bcccc2;
        }
        .jumbotron h2 small{
            color: rgba(210, 218, 225, 0.83);
        }
        #tregist{
            margin-bottom: 150px;
        }
        #ttbutton{
            text-align: center;
        }

    </style>
    <script>
        $(function () {
            function checkUsername() {
                //1.获取用户名值
                var username = $("#username").val();
                //2.定义正则
                var reg_username = /^\w{8,20}$/;

                //3.判断，给出提示信息
                var flag = reg_username.test(username);
                if(flag){
                    //用户名合法
                    $("#username").css("border","");
                    $('#error_username').text("");
                }else{
                    //用户名非法,加一个红色边框
                    $("#username").css("border","1px solid red");
                    $('#error_username').css({"color":"red"}).html("格式错误");
                    // $('#error_username').parent().css({"width":"70px"})
                }

                return flag;
            }
            function checkPassword() {
                //1.获取用户名值
                var password = $("#password").val();
                //2.定义正则
                var reg_password = /^\w{8,20}$/;

                //3.判断，给出提示信息
                var flag = reg_password.test(password);
                if(flag){
                    //用户名合法
                    $("#password").css("border","");
                    $('#error_password').text("");
                }else{
                    //用户名非法,加一个红色边框
                    $("#password").css("border","1px solid red");
                    $('#error_password').css({"color":"red"}).html("格式错误");
                    // $('#error_password').parent().css({"width":"70px"})
                }

                return flag;
            }
            function checkEmail() {
                //1.获取用户名值
                var email = $("#email").val();
                //2.定义正则
                var reg_email = /^\w+@\w+\.\w+$/;

                //3.判断，给出提示信息
                var flag = reg_email.test(email);
                if(flag){
                    //用户名合法
                    $("#email").css("border","");
                    $('#error_email').text("");
                }else{
                    //用户名非法,加一个红色边框
                    $("#email").css("border","1px solid red");
                    $('#error_email').css({"color":"red"}).html("格式错误");
                    // $('#error_email').parent().css({"width":"70px"})
                }

                return flag;
            }
            $('#tbutton').click(function () {
                if($('#username').blur(checkUsername)&&$('#email').blur(checkEmail)&&$('#password').blur(checkPassword)){
                    $('#warning').css({"background":"","color":"red"}).html("已提交，正在创建用户……");
                    $.ajax({
                        url:"/regist",
                        timeout:20000,
                        contentType:"application/json;charset=UTF-8",
                        data:JSON.stringify($('#tform').serializeJSON()),
                        type:"post",
                        success:function (data) {
                            console.log(data);
                            if(data.flag==false){
                                $('#warning').css({"background":"blue","color":"red"}).html(data.errorMsg)
                            }else{
                                $('#warning').css({"background":"","color":"blue"}).html("成功创建用户，请邮件激活");

                                // $('#warning').html("成功");
                            }
                        }
                    })
                }
            });
            $('#username').blur(checkUsername);
            $('#email').blur(checkEmail);
            $('#password').blur(checkPassword);
        })

    </script>

</head>

<body>
<!--<ul class="nav nav-tabs">-->
<!--    <li role="presentation" class="active"><a href="#">Home</a></li>-->
<!--    <li role="presentation"><a href="#">Profile</a></li>-->
<!--    <li role="presentation"><a href="#">Messages</a></li>-->
<!--</ul>-->
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">
                <img src="img/1168148.png" height="30px">
            </a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav">
                <li ><a href="#">当前作物信息</a></li>
                <li><a href="#">视频直播</a></li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">历史信息<span class="caret"></span></a>
                    <ul class="dropdown-menu">
                        <li><a href="#">历史环境信息总表</a></li>
                        <li><a href="#">历史空气温湿度表</a></li>
                        <li><a href="#">历史土壤湿度表</a></li>
                        <li><a href="#">历史光照强度表</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">历史操作记录</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">历史提醒记录</a></li>
                    </ul>
                </li>
            </ul>
            <form class="navbar-form navbar-left">
                <div class="form-group">
                    <input type="text" class="form-control" placeholder="快速检索">
                </div>
                <button type="submit" class="btn btn-default">搜索</button>
            </form>
            <ul class="nav navbar-nav navbar-right">
                <li><a href="http://106.14.162.154:82/">控制台</a></li>
                <li><a href="#">设置</a></li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">用户 <span class="caret"></span></a>
                    <ul class="dropdown-menu">
                        <li><a href="#">详细信息</a></li>
                        <li><a href="#">成员管理</a></li>
                        <li><a href=regist.html>注册</a></li>
                        <li><a href=login.html>登录</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">登出</a></li>
                    </ul>
                </li>
            </ul>
        </div><!-- /.navbar-collapse -->
    </div><!-- /.container-fluid -->
</nav>
<div class="container-fluid">
    <div class="jumbotron">
        <h1>节能减排小组DEMO</h1>
        <p><strong>This is a simple hero unit, a simple jumbotron-style component for calling extra attention to featured
            content or information.</strong></p>
        <h2>用科技 <small>让世界更简单</small></h2>
        <p><a class="btn btn-primary btn-lg" href="#" role="button">Learn more</a></p>
    </div>
</div>
<div class="container" id="tregist">
    <div class="row">
        <h1 class="col-md-3 col-md-offset-2">注册 <small>login up</small></h1>
        <div class="col-md-3" id="warning">
        </div>
    </div>
    <div class="row">
        <form class="col-md-4 col-md-offset-4" id="tform">
            <div class="form-group">
                <label for="username">请输入用户名</label>
                <input type="email" class="form-control" id="username" placeholder="name" name="username">
                <p id="error_username"></p>
            </div>
            <div class="form-group">
                <label for="email">请输入电子邮箱</label>
                <input type="email" class="form-control" id="email" placeholder="Email" name="email">
                <p id="error_email"></p>
            </div>
            <div class="form-group">
                <label for="password">请输入密码</label>
                <input type="password" class="form-control" id="password" placeholder="Password" name="password">
                <p id="error_password"></p>
            </div>
            <div id="ttbutton">
                <button type="button" class="btn btn-primary" id="tbutton">注册</button>
            </div>
        </form>
    </div>
</div>
<nav class="navbar navbar-default navbar-fixed-bottom">
    <div class="container">

    </div>
</nav>

</body>
</html>
```

### login.css

```css

html,
body {
    background: #efefef;
    padding: 10px;
    font-family: 'Varela Round';
}
/*=== 2. Anchor Link ===*/
a {
    color: #aaaaaa;
    transition: all ease-in-out 200ms;
}
a:hover {
    color: #333333;
    text-decoration: none;
}
/*=== 3. Text Outside the Box ===*/
.etc-login-form {
    color: #919191;
    padding: 10px 20px;
}
.etc-login-form p {
    margin-bottom: 5px;
}
/*=== 4. Main Form ===*/
.login-form-1 {
    max-width: 300px;
    border-radius: 5px;
    display: inline-block;
}
.main-login-form {
    position: relative;
}
.login-form-1 .form-control {
    border: 0;
    box-shadow: 0 0 0;
    border-radius: 0;
    background: transparent;
    color: #555555;
    padding: 7px 0;
    font-weight: bold;
    height:auto;
}
.login-form-1 .form-control::-webkit-input-placeholder {
    color: #999999;
}
.login-form-1 .form-control:-moz-placeholder,
.login-form-1 .form-control::-moz-placeholder,
.login-form-1 .form-control:-ms-input-placeholder {
    color: #999999;
}
.login-form-1 .form-group {
    margin-bottom: 0;
    border-bottom: 2px solid #efefef;
    padding-right: 20px;
    position: relative;
}
.login-form-1 .form-group:last-child {
    border-bottom: 0;
}
.login-group {
    background: #ffffff;
    color: #999999;
    border-radius: 8px;
    padding: 10px 20px;
}
.login-group-checkbox {
    padding: 5px 0;
}
/*=== 5. Login Button ===*/
.login-form-1 .login-button {
    position: absolute;
    right: -25px;
    top: 50%;
    background: #ffffff;
    color: #999999;
    padding: 11px 0;
    width: 50px;
    height: 50px;
    margin-top: -25px;
    border: 5px solid #efefef;
    border-radius: 50%;
    transition: all ease-in-out 500ms;
}
.login-form-1 .login-button:hover {
    color: #555555;
    transform: rotate(450deg);
}
.login-form-1 .login-button.clicked {
    color: #555555;
}
.login-form-1 .login-button.clicked:hover {
    transform: none;
}
.login-form-1 .login-button.clicked.success {
    color: #2ecc71;
}
.login-form-1 .login-button.clicked.error {
    color: #e74c3c;
}
/*=== 6. Form Invalid ===*/
label.form-invalid {
    position: absolute;
    top: 0;
    right: 0;
    z-index: 5;
    display: block;
    margin-top: -25px;
    padding: 7px 9px;
    background: #777777;
    color: #ffffff;
    border-radius: 5px;
    font-weight: bold;
    font-size: 11px;
}
label.form-invalid:after {
    top: 100%;
    right: 10px;
    border: solid transparent;
    content: " ";
    height: 0;
    width: 0;
    position: absolute;
    pointer-events: none;
    border-color: transparent;
    border-top-color: #777777;
    border-width: 6px;
}
/*=== 7. Form - Main Message ===*/
.login-form-main-message {
    background: #ffffff;
    color: #999999;
    border-left: 3px solid transparent;
    border-radius: 3px;
    margin-bottom: 8px;
    font-weight: bold;
    height: 0;
    padding: 0 20px 0 17px;
    opacity: 0;
    transition: all ease-in-out 200ms;
}
.login-form-main-message.show {
    height: auto;
    opacity: 1;
    padding: 10px 20px 10px 17px;
}
.login-form-main-message.success {
    border-left-color: #2ecc71;
}
.login-form-main-message.error {
    border-left-color: #e74c3c;
}
/*=== 8. Custom Checkbox & Radio ===*/
/* Base for label styling */
[type="checkbox"]:not(:checked),
[type="checkbox"]:checked,
[type="radio"]:not(:checked),
[type="radio"]:checked {
    position: absolute;
    left: -9999px;
}
[type="checkbox"]:not(:checked) + label,
[type="checkbox"]:checked + label,
[type="radio"]:not(:checked) + label,
[type="radio"]:checked + label {
    position: relative;
    padding-left: 25px;
    padding-top: 1px;
    cursor: pointer;
}
/* checkbox aspect */
[type="checkbox"]:not(:checked) + label:before,
[type="checkbox"]:checked + label:before,
[type="radio"]:not(:checked) + label:before,
[type="radio"]:checked + label:before {
    content: '';
    position: absolute;
    left: 0;
    top: 2px;
    width: 17px;
    height: 17px;
    border: 0px solid #aaa;
    background: #f0f0f0;
    border-radius: 3px;
    box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.3);
}
/* checked mark aspect */
[type="checkbox"]:not(:checked) + label:after,
[type="checkbox"]:checked + label:after,
[type="radio"]:not(:checked) + label:after,
[type="radio"]:checked + label:after {
    position: absolute;
    color: #555555;
    transition: all .2s;
}
/* checked mark aspect changes */
[type="checkbox"]:not(:checked) + label:after,
[type="radio"]:not(:checked) + label:after {
    opacity: 0;
    transform: scale(0);
}
[type="checkbox"]:checked + label:after,
[type="radio"]:checked + label:after {
    opacity: 1;
    transform: scale(1);
}
/* disabled checkbox */
[type="checkbox"]:disabled:not(:checked) + label:before,
[type="checkbox"]:disabled:checked + label:before,
[type="radio"]:disabled:not(:checked) + label:before,
[type="radio"]:disabled:checked + label:before {
    box-shadow: none;
    border-color: #8c8c8c;
    background-color: #878787;
}
[type="checkbox"]:disabled:checked + label:after,
[type="radio"]:disabled:checked + label:after {
    color: #555555;
}
[type="checkbox"]:disabled + label,
[type="radio"]:disabled + label {
    color: #8c8c8c;
}
/* accessibility */
[type="checkbox"]:checked:focus + label:before,
[type="checkbox"]:not(:checked):focus + label:before,
[type="checkbox"]:checked:focus + label:before,
[type="checkbox"]:not(:checked):focus + label:before {
    border: 1px dotted #f6f6f6;
}
/* hover style just for information */
label:hover:before {
    border: 1px solid #f6f6f6 !important;
}
/*=== Customization ===*/
/* radio aspect */
[type="checkbox"]:not(:checked) + label:before,
[type="checkbox"]:checked + label:before {
    border-radius: 3px;
}
[type="radio"]:not(:checked) + label:before,
[type="radio"]:checked + label:before {
    border-radius: 35px;
}
/* selected mark aspect */
[type="checkbox"]:not(:checked) + label:after,
[type="checkbox"]:checked + label:after {
    content: '✔';
    top: 0;
    left: 2px;
    font-size: 14px;
}
[type="radio"]:not(:checked) + label:after,
[type="radio"]:checked + label:after {
    content: '\2022';
    top: 0;
    left: 3px;
    font-size: 30px;
    line-height: 25px;
}
/*=== 9. Misc ===*/
.logo {
    padding: 15px 0;
    font-size: 25px;
    color: #aaaaaa;
    font-weight: bold;
}

```

### 前端正则表达式验证

```html
<script>
    $(function () {
        function checkUsername() {
            //1.获取用户名值
            var username = $("#lg_username").val();
            //2.定义正则
            var reg_username = /^\w{8,20}$/;

            //3.判断，给出提示信息
            var flag = reg_username.test(username);
            if(flag){
                //用户名合法
                $("#lg_username").css("border","");
                $('#error_username').text("");
            }else{
                //用户名非法,加一个红色边框
                $("#lg_username").css("border","1px solid red");
                $('#error_username').css({"color":"red"}).html("用户名格式错误");
                // $('#error_username').parent().css({"width":"70px"})
            }

            return flag;
        }
        function checkPassword() {
            //1.获取用户名值
            var password = $("#lg_password").val();
            //2.定义正则
            var reg_password = /^\w{8,20}$/;

            //3.判断，给出提示信息
            var flag = reg_password.test(password);
            if(flag){
                //用户名合法
                $("#lg_password").css("border","");
                $('#error_password').text("");
            }else{
                //用户名非法,加一个红色边框
                $("#lg_password").css("border","1px solid red");
                $('#error_password').css({"color":"red"}).html("格式错误");
                // $('#error_password').parent().css({"width":"70px"})
            }

            return flag;
        }

        $('#tbutton').click(function () {
            if (checkUsername()&&checkUsername()) {
                $('#errorMsg').css({"color":"red"}).html('<p>登陆中……</p>');
                $.ajax({
                    url: "/login",
                    type: "post",
                    contentType: "application/json;charset=UTF-8",
                    data: JSON.stringify($('#login-form').serializeJSON()),
                    success: function (data) {
                        console.log(data);
                        if(data.flag==false){
                            $('#errorMsg').css({"background":"blue","color":"red"}).html(data.errorMsg);
                        }else {
                            $('#errorMsg').css({"background":"","color":"blue"}).html("登录成功");
                        }
                    }
                })
            }
        });
        $('#lg_username').blur(checkUsername);
        $('#lg_password').blur(checkPassword);
    })
</script>
```

## 后端

### 用户管理控制器

```java
package org.suyuesheng.spring7.controller;

import com.alibaba.fastjson.JSON;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.*;
import org.suyuesheng.spring7.pojo.ResultInfo;
import org.suyuesheng.spring7.pojo.User;
import org.suyuesheng.spring7.services.UserService;
import org.suyuesheng.spring7.util.GetDomainName;
import org.suyuesheng.spring7.util.GetUUID;

import javax.servlet.http.Cookie;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;
import java.io.IOException;
import java.util.Date;
import java.util.Enumeration;
import java.util.Map;

@Controller
public class forUser {
    @Autowired
    private UserService userService;

    /**
     * 这样设置初始页面不好使
     * @return
     */
    @GetMapping("/")
    public String index(){
        return "forward:/login.html";
    }

    @GetMapping("/regist")
    public String regist(){
        return "forward:/regist.html";
    }

    @ResponseBody
    @RequestMapping(value = "/regist",method = RequestMethod.POST)
    public Object regist(@RequestBody Map<String,Object> map,ResultInfo resultInfo,HttpServletRequest request){
        System.out.println(map);
        User user = new User();
        user.setUserName((String)map.get("username"));
        user.setPassword((String)map.get("password"));
        user.setEmail((String)map.get("email"));
        user.setStatus("N");
        user.setDate(new Date());
        System.out.println(user);
        userService.insertUser(user,resultInfo,request);
        return JSON.toJSON(resultInfo);
    }

    @RequestMapping("/active")
    public void active(@RequestParam("code") String code, HttpServletResponse response,HttpServletRequest request) throws IOException {
        response.setContentType("text/html;charset=UTF-8");
        String url = request.getRequestURL().toString();
        if (code!=null && !code.equals("")){
            if(userService.activeUser(code)){
                String ur = GetDomainName.getDomainName(url) + "login.html";
                System.out.println(ur);
                String msg= "<p>注册成功，请去登录，<a href=\""+ur+"\">登录</a><p>";
                response.getWriter().write(msg);
            }else {
                String msg= "<p>登陆失败，请联系管理员</p>";
                response.getWriter().write(msg);
            }
        }else{
            String msg="<h2>该验证码不存在，请从新注册</h2>";
            response.getWriter().write(msg);
        }
    }

    @ResponseBody
    @RequestMapping(value = "/login",method = RequestMethod.POST)
    public Object login(@RequestBody Map<String,Object> map, ResultInfo resultInfo, HttpServletResponse response, HttpServletRequest request){
        HttpSession session = request.getSession();
        boolean login = userService.login((String) map.get("username"), (String) map.get("password"), resultInfo);
        if(login){
            session.setAttribute("login", "true");
            session.setAttribute("whlogin", userService.findByName((String)map.get("username")));
            Cookie c = new Cookie("JSESSIONID",session.getId());
            c.setMaxAge(60*60*24*4);
            response.addCookie(c);
            return JSON.toJSON(resultInfo);
        }
        return JSON.toJSON(resultInfo);
    }

    @GetMapping("/login")
    public String login(){
        return "forward:/login.html";
    }


    @ResponseBody
    @RequestMapping(value = "/test/session")
    public Object testSession(HttpServletRequest request){
        HttpSession session = request.getSession();
        Object login = session.getAttribute("login");
        System.out.println(request.getRequestURL());
        return (String)login;
    }
}
```

### jdbc

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.suyuesheng.spring7.mapper.UserMapper">
    <cache
            eviction="FIFO"
            flushInterval="60000"
            size="512"
            readOnly="true"/>
    <resultMap id="userMap" type="user">
        <result property="uId" column="uid"/>
        <result property="userName" column="username"/>
    </resultMap>
    <select id="findAll" resultType="user">
        select * from User
    </select>

    <select id="findById" resultType="user" parameterType="_int">
        select * from User
        <where>
            <if test="uId!=null">
                uid=#{uId}
            </if>
        </where>
    </select>

    <insert id="insert" parameterType="user">
        insert into User
        <choose>
            <when test="uId==null">
                (username, password, status, code, date,email)
                values(#{userName},#{password},#{status},#{code},#{date},#{email})
            </when>
            <when test="uId!=null">
                (uid, username, password, status, code, date,email)
                values(#{uId},#{userName},#{password},#{status},#{code},#{date},#{email})
            </when>
        </choose>
    </insert>

    <update id="updateActive" parameterType="string">
        update User
        <set>
            <if test="code!=null">
                status='Y'
            </if>
        </set>
        <where>
            <if test="code!=null">
                code=#{code}
            </if>
        </where>
    </update>

    <select id="findByCode" parameterType="string" resultType="user">
        select * from User
        <where>
            <if test="code!=null">
                code=#{code}
            </if>
        </where>
    </select>

    <select id="findByName" parameterType="string" resultType="user">
        select * from User
        <trim prefix="WHERE" prefixOverrides="AND |OR">
            <if test="username!=null">
                username=#{username}
            </if>
        </trim>
    </select>
</mapper>
```

### 拦截器配置

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:mvc="http://www.springframework.org/schema/mvc"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.springframework.org/schema/mvc
       https://www.springframework.org/schema/mvc/spring-mvc.xsd
       http://www.springframework.org/schema/context
       https://www.springframework.org/schema/context/spring-context.xsd">

    <context:annotation-config/>
    <context:component-scan base-package="org.suyuesheng.spring7"/>
    <import resource="mybatisBean.xml"/>
    <import resource="springmvcconfig.xml"/>
    <bean class="org.suyuesheng.spring7.pojo.User" id="user"/>
<!--    配置拦截器-->
    <mvc:interceptors>
        <mvc:interceptor>
            <mvc:mapping path="/"/>
            <mvc:mapping path="/**"/>
            <mvc:mapping path="/**/*.html"/>
            <mvc:mapping path="/index.html"/>
            <mvc:exclude-mapping path="/login*"/>
            <mvc:exclude-mapping path="/regist*"/>
            <mvc:exclude-mapping path="/**/*.js"/>
            <mvc:exclude-mapping path="/**/*.css"/>
            <mvc:exclude-mapping path="/bootstrap-3.3.7-dist/**"/>
            <mvc:exclude-mapping path="/img/**"/>
            <mvc:exclude-mapping path="/active"/>
            <bean class="org.suyuesheng.spring7.interceptor.Logininterceptor" id="logininterceptor"/>
        </mvc:interceptor>
    </mvc:interceptors>
</beans>
```

## 本地端 树莓派

### 传感器控制

```python
# coding=UTF-8
#!/usr/bin/python

import RPi.GPIO as GPIO
import time
for i in range (10): #这里设置的是循环十次，在实际应用中可以改为 while True:
    channel = 16  # 引脚号16，这是设置dht11用的
    data = []  # 温湿度值
    j = 0
    # 计数器
    a=20
    GPIO.setmode(GPIO.BCM)  # 以BCM编码格式

    time.sleep(1)  # 时延一秒

    GPIO.setup(channel, GPIO.OUT)

    GPIO.output(channel, GPIO.LOW)
    time.sleep(0.02)  # 给信号提示传感器开始工作
    GPIO.output(channel, GPIO.HIGH)

    GPIO.setup(channel, GPIO.IN)

    while GPIO.input(channel) == GPIO.LOW:
        continue

    while GPIO.input(channel) == GPIO.HIGH:
        continue

    while j < 40:
        k = 0
        while GPIO.input(channel) == GPIO.LOW:
            continue

        while GPIO.input(channel) == GPIO.HIGH:
            k += 1
            if k > 100:
                break

        if k < 8:
            data.append(0)
        else:
            data.append(1)

        j += 1

    print "开始工作."
   # print  data  # 输出初始数据高低电平

    humidity_bit = data[0:8]  # 分组
    humidity_point_bit = data[8:16]
    temperature_bit = data[16:24]
    temperature_point_bit = data[24:32]
    check_bit = data[32:40]

    humidity = 0
    humidity_point = 0
    temperature = 0
    temperature_point = 0
    check = 0

    for i in range(8):
        humidity += humidity_bit[i] * 2 ** (7 - i)  # 转换成十进制数据
        humidity_point += humidity_point_bit[i] * 2 ** (7 - i)
        temperature += temperature_bit[i] * 2 ** (7 - i)
        temperature_point += temperature_point_bit[i] * 2 ** (7 - i)
        check += check_bit[i] * 2 ** (7 - i)

    tmp = humidity + humidity_point + temperature + temperature_point  # 十进制的数据相加

    if check == tmp:  # 数据校验，相等则输出
        print "temperature : ", temperature, ", humidity : ", humidity
        c="温度"+str(temperature)+"."+"/"+"湿度"+str(humidity)
        GPIO.setup(21, GPIO.IN)
        if GPIO.input(21) == GPIO.LOW:#设置土壤湿度传感器
            print "土壤检测结果：潮湿"
            c=c+"\n"+"土壤潮湿"+"\n"+"推荐不要浇水，具体以机器操作为准"
        else:
            print "土壤检测结果：干燥"
            c=c+"\n"+"土壤干燥"+"\n"+"推荐浇水，具体以机器操作为准"
        f=open("123.txt","w+") #将数据写入文件
        f.write(c)
        f.close
        if temperature >= 20:
            print"jiaoshui"
            GPIO.setup(25, GPIO.OUT)#控制继电器
            GPIO.output(25, GPIO.LOW)#这句意义不大，也可以是high，因为电阻不合适无论高低电平都是通路，所以只能采用setup后再cleanup。
            print("3")#我这里设置的是浇水时间3秒
            time.sleep(1.0)
            print("2")
            time.sleep(1.0)
            print("1")
            time.sleep(1.0)
            GPIO.cleanup()
            GPIO.setmode(GPIO.BCM)  # 以BCM编码格式

            time.sleep(1)  # 时延一秒

            GPIO.setup(channel, GPIO.OUT)

            GPIO.output(channel, GPIO.LOW)
    else:  # 错误输出错误信息，和校验数据
        print "出现错误，输出校验结果"
        print "temperature : ", temperature, ", humidity : ", humidity, " check : ", check, " tmp : ", tmp
    time.sleep(2) #每隔2秒检测一次

    GPIO.cleanup()  # 重置针脚
```

### 树莓派通过ssh协议像服务器传输数据

```shell
#!/bin/sh
now=date'+%Y-%m-%d %H:%M:%S'
folder=/root/tran
cd $floder
while true
do
	now=date'+%Y-%m-%d %H:%M:%S'
	echo -e $now'start'>>log.txt
	scp 123.txt root@xxx.xx.xxx.xxx:/www/wwwroot/http/1.txt
	sleep 5
done
```



