# mybatis å­¦ä¹ ç¬”è®°

## 0.ç®€ä»‹

```
MyBatis æ˜¯ä¸€æ¬¾ä¼˜ç§€çš„æŒä¹…å±‚æ¡†æ¶ï¼Œå®ƒæ”¯æŒè‡ªå®šä¹‰ SQLã€å­˜å‚¨è¿‡ç¨‹ä»¥åŠé«˜çº§æ˜ å°„ã€‚MyBatis å…é™¤äº†å‡ ä¹æ‰€æœ‰çš„ JDBC ä»£ç ä»¥åŠè®¾ç½®å‚æ•°å’Œè·å–ç»“æœé›†çš„å·¥ä½œã€‚MyBatis å¯ä»¥é€šè¿‡ç®€å•çš„ XML æˆ–æ³¨è§£æ¥é…ç½®å’Œæ˜ å°„åŸå§‹ç±»å‹ã€æ¥å£å’Œ Java POJOï¼ˆPlain Old Java Objectsï¼Œæ™®é€šè€å¼ Java å¯¹è±¡ï¼‰ä¸ºæ•°æ®åº“ä¸­çš„è®°å½•ã€‚
```

## 1.ä¸‹è½½å®‰è£…

**GitHubï¼š[mybatis3.5.2](https://github.com/mybatis/mybatis-3/releases/download/mybatis-3.5.2/mybatis-3.5.2.zip)**

**ä¸­æ–‡æ–‡æ¡£ï¼š[mybatisä¸­æ–‡æ–‡æ¡£](https://mybatis.org/mybatis-3/zh/index.html)**

**mavenä»“åº“**

```xml
<!-- https://mvnrepository.com/artifact/org.mybatis/mybatis -->
<dependency>
    <groupId>org.mybatis</groupId>
    <artifactId>mybatis</artifactId>
    <version>3.5.2</version>
</dependency>

```

**pom.xml**

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <groupId>org.suyuesheng</groupId>
    <artifactId>osuo</artifactId>
    <version>1.0-SNAPSHOT</version>
    <repositories>
        <repository>
            <id>alimaven</id>
            <name>aliyun maven</name>
            <url>http://maven.aliyun.com/nexus/content/groups/public/</url>
            <releases>
                <enabled>true</enabled>
            </releases>
            <snapshots>
                <enabled>false</enabled>
            </snapshots>
        </repository>
    </repositories>
    <properties>
        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
        <maven.compiler.source>1.7</maven.compiler.source>
        <maven.compiler.target>1.7</maven.compiler.target>
    </properties>
    <dependencies>
        <dependency>
            <groupId>junit</groupId>
            <artifactId>junit</artifactId>
            <version>4.11</version>
            <scope>test</scope>
        </dependency>
        <dependency>
            <groupId>mysql</groupId>
            <artifactId>mysql-connector-java</artifactId>
            <version>8.0.19</version>
        </dependency>
        <dependency>
            <groupId>com.alibaba</groupId>
            <artifactId>druid</artifactId>
            <version>1.1.22</version>
        </dependency>
        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-core</artifactId>
            <version>4.1.2.RELEASE</version>
            <scope>compile</scope>
        </dependency>
        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-jdbc</artifactId>
            <version>4.1.2.RELEASE</version>
            <scope>compile</scope>
        </dependency>
        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-tx</artifactId>
            <version>4.1.2.RELEASE</version>
            <scope>compile</scope>
        </dependency>
        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-beans</artifactId>
            <version>4.1.2.RELEASE</version>
            <scope>compile</scope>
        </dependency>
        <dependency>
            <groupId>commons-logging</groupId>
            <artifactId>commons-logging</artifactId>
            <version>1.1.1</version>
            <scope>compile</scope>
        </dependency>
        <dependency>
            <groupId>org.mybatis</groupId>
            <artifactId>mybatis</artifactId>
            <version>3.5.2</version>
        </dependency>
        <dependency>
            <groupId>log4j</groupId>
            <artifactId>log4j</artifactId>
            <version>1.2.17</version>
        </dependency>
    </dependencies>

    <build>
        <resources>
            <resource>
                <directory>src/main/java</directory>
                <includes>
                    <include>**/*.xml</include>
                    <include>**/*.properties</include>
                </includes>
            </resource>
            <resource>
                <directory>src/main/resources</directory>
            </resource>
        </resources>
        <pluginManagement><!-- lock down plugins versions to avoid using Maven defaults (may be moved to parent pom) -->
            <plugins>
                <plugin>
                    <artifactId>maven-clean-plugin</artifactId>
                    <version>3.1.0</version>
                </plugin>
                <!-- see http://maven.apache.org/ref/current/maven-core/default-bindings.html#Plugin_bindings_for_war_packaging -->
                <plugin>
                    <artifactId>maven-resources-plugin</artifactId>
                    <version>3.0.2</version>
                </plugin>
                <plugin>
                    <artifactId>maven-surefire-plugin</artifactId>
                    <version>2.22.1</version>
                </plugin>
                <plugin>
                    <artifactId>maven-war-plugin</artifactId>
                    <version>3.2.2</version>
                </plugin>
                <plugin>
                    <artifactId>maven-install-plugin</artifactId>
                    <version>2.5.2</version>
                </plugin>
                <plugin>
                    <artifactId>maven-deploy-plugin</artifactId>
                    <version>2.8.2</version>
                </plugin>
                <plugin>
                    <groupId>org.apache.maven.plugins</groupId>
                    <artifactId>maven-compiler-plugin</artifactId>
                    <version>3.8.1</version>
                    <configuration>
                        <source>1.8</source>
                        <target>1.8</target>
                        <encoding>utf-8</encoding>
                    </configuration>
                </plugin>
                <plugin>

                    <groupId>org.apache.tomcat.maven</groupId>

                    <artifactId>tomcat7-maven-plugin</artifactId>

                    <version>2.2</version>

                </plugin>
            </plugins>
        </pluginManagement>
    </build>

</project>
```

**sql**

```sql
create database if not exists mybatisstudy character set utf8;
show variables like '%chara%';
use mybatisstudy;
create table user (
    id int not null primary key ,
    name varchar(20) not null ,
    pwd varchar(20) not null
) character set utf8;
desc user;
insert into user values (1,'è€å¼ ','1234567');
insert into user values (2,'laoliu','12233');
insert into user values (3,'æ€æ€','12233');
SELECT * FROM user;
```

### 1.1åˆ›å»ºæ¨¡å—

**mybatis.config.xml**

è¿™æ˜¯mybatisçš„é…ç½®æ–‡ä»¶

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE configuration
        PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-config.dtd">
<configuration>
    <environments default="development">
        <environment id="development">
            <transactionManager type="JDBC"/>
            <dataSource type="POOLED">
                <property name="driver" value="com.mysql.cj.jdbc.Driver"/>
                <property name="url" value="jdbc:mysql://localhost:3307/mybatisstudy?characterEncoding=utf-8&amp;useUnicode=true"/>
                <property name="username" value="root"/>
                <property name="password" value="su15990904343"/>
            </dataSource>
        </environment>
    </environments>
        <mappers>
            <mapper resource="UserMapper.xml"/>
        </mappers>
</configuration>
```

***å¤‡æ³¨ï¼šåœ¨xmlæ–‡ä»¶ä¸­ `&` éœ€è¦ç”¨` &amp;`æ¥è¡¨ç¤ºï¼Œå¦‚æœ `mysql-connector` çš„ç‰ˆæœ¬å¤§äº6ï¼Œdriveråº”è¯¥æ˜¯`com.mysql.cj.jdbc.Driver`ã€‚***

sqlsession çš„utilæ–‡ä»¶

```java
package cn.ssm.suyuesheng.utils;

import org.apache.ibatis.session.SqlSession;
import org.apache.ibatis.session.SqlSessionFactory;
import org.apache.ibatis.session.SqlSessionFactoryBuilder;

import java.io.InputStream;

public class SqlsessionUtil {
    private static SqlSession sqlSession;
    private static SqlSessionFactory sqlSessionFactory;

    static {
        InputStream resourceAsStream = SqlsessionUtil.class.getResourceAsStream("mybatis.config.xml");
        sqlSessionFactory = new SqlSessionFactoryBuilder().build(resourceAsStream);
        sqlSession = sqlSessionFactory.openSession();
    }

    public static SqlSession getSqlSession() {
        return sqlSession;
    }

    public static SqlSessionFactory getSqlSessionFactory() {
        return sqlSessionFactory;
    }
}

```

**mapperçš„é…ç½®   <a href="#mapperconfig">è·³è½¬åˆ°mapperè¯¦ç»†é…ç½®</a>**

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.ssm.suyuesheng.Dao.UserDao">
    <select id="findAll" resultType="cn.ssm.suyuesheng.domain.User">
    select * from user
  </select>
</mapper>
```

**æ³¨æ„ï¼š`namespace`  å’Œ`resultType`åº”è¯¥æŠŠè·¯å¾„å†™å…¨ï¼Œ`id`å¯¹åº”çš„æ˜¯æ–¹æ³•åç§°ï¼Œ`namespace`å¯¹åº”çš„æ˜¯DAOç±»(åœ¨mybatisé‡Œå«Mapperç±»)ã€‚_åœ¨è¿™é‡Œæˆ‘å°†`UserMapper.xml`æ”¾åœ¨äº†src/main/resourseé‡Œé¢ï¼Œå¦‚æœæŠŠ`UserMapper.xml`æ”¾åœ¨src/main/javaé‡Œé¢éœ€è¦åœ¨pom.xmlé‡Œé¢é…ç½®è¿‡æ»¤_**

#### è¿‡æ»¤è¿™æ ·é…ç½®

```xml
<resources>
      <resource>
        <directory>src/main/java</directory>
        <includes>
          <include>**/*.xml</include>
          <include>**/*.properties</include>
        </includes>
      </resource>
      <resource>
        <directory>src/main/resources</directory>
      </resource>
    </resources>
```

**`filtering`é»˜è®¤æ˜¯falseï¼Œæ•…ä¸é…ç½®`filtering`ã€‚å¾…åˆ°éœ€è¦çš„æ—¶å€™å¯ä»¥è‡ªè¡Œé…ç½®**

## 2 .ä½¿ç”¨æ¨¡å—

```java
package cn.ssm.suyuesheng.Dao;

import cn.ssm.suyuesheng.domain.User;
import cn.ssm.suyuesheng.utils.SqlsessionUtil;
import org.apache.ibatis.session.SqlSession;
import org.junit.Test;

import java.util.List;

public class UserDaoTest {
    @Test
    public void TestOne(){
        //æ–¹æ³•ä¸€
        SqlSession sqlSession = SqlsessionUtil.getSqlSession();
        UserDao mapper = sqlSession.getMapper(UserDao.class);
        List<User> users = mapper.findAll();
        System.out.println(users);
        sqlSession.close();
    }
    @Test
    public void TestTwo(){
        //æ–¹å¼äºŒ
        SqlSession sqlSession = SqlsessionUtil.getSqlSession();
        List<User> list = sqlSession.selectList("cn.ssm.suyuesheng.Dao.UserDao.findAll");
        for (User user : list) {
            System.out.println(user);
        }
    }
}

```

### 2.1mapper(æ˜ å°„å™¨)è¯¦ç»†é…ç½®

*å‚è€ƒèµ„æ–™   https://mybatis.org/mybatis-3/zh/sqlmap-xml.html#insert_update_and_delete*

#### 2.1.1 crudçš„å®ç°

**æ¥å£**

```java
package cn.ssm.suyuesheng.Dao;

import cn.ssm.suyuesheng.domain.User;

import java.util.List;

public interface UserDao {
    List<User> findAll();

    User findById(int id);

    boolean insertUser(User user);

    boolean update(User user);

    boolean remove(int id);
}

```

è¿™ä¸ªæ¥å£æœ‰å¢æŸ¥åˆ æ”¹ç­‰åŠŸèƒ½ï¼ŒåŠŸèƒ½çš„å®ç°è¦åˆ°å¯¹åº”mapperçš„xmlæ–‡ä»¶å»å£°æ˜

#### 2.1.2**UserMapper.xml**ğŸ‘‡

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.ssm.suyuesheng.Dao.UserDao">
<!--    findAllæ–¹æ³•-->
    <select id="findAll" resultType="cn.ssm.suyuesheng.domain.User">
    select * from user
    </select>

<!-- findById-->
    <select id="findById" parameterType="int" resultType="cn.ssm.suyuesheng.domain.User">
        select * from user where id=#{id}
    </select>
<!-- insertUser-->
    <insert id="insertUser" parameterType="cn.ssm.suyuesheng.domain.User">
        insert into user values(#{id},#{name},#{pwd})
    </insert>
<!-- update-->
    <update id="update" parameterType="cn.ssm.suyuesheng.domain.User">
        UPDATE user SET pwd=#{pwd},name=#{name} where id=${id}
    </update>
<!-- remove-->
    <delete id="remove" parameterType="int" >
        delete from user where id=${id}
    </delete>
</mapper>
```

**namespace**  å¯¹åº”æ¥å£åç§°

> å‘½åè§£æ: ä¸ºäº†å‡å°‘è¾“å…¥é‡ï¼ŒMyBatiså¯¹æ‰€æœ‰çš„å‘½åé…ç½®å…ƒç´ (åŒ…æ‹¬è¯­å¥ï¼Œç»“æœæ˜ å°„ï¼Œç¼“å­˜ç­‰)ä½¿ç”¨äº†å¦‚ä¸‹çš„å‘½åè§£æè§„åˆ™ã€‚
>
> - å®Œå…¨é™å®šå(æ¯”å¦‚"com.mypackage.MyMapper.selectAllThings")å°†è¢«ç›´æ¥æŸ¥æ‰¾å¹¶ä¸”æ‰¾åˆ°å³ç”¨ã€‚
> - çŸ­åç§°(æ¯”å¦‚"selectAllThings")å¦‚æœå…¨å±€å”¯ä¸€ä¹Ÿå¯ä»¥ä½œä¸ºä¸€ä¸ªå•ç‹¬çš„å¼•ç”¨ã€‚å¦‚æœä¸å”¯ä¸€ï¼Œæœ‰ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„ç›¸åŒåç§°(æ¯”å¦‚â€œcom.foo.selectAllThings â€å’Œâ€œcom.bar.selectAllThingsâ€), é‚£ä¹ˆä½¿ç”¨æ—¶å°±ä¼šæ”¶åˆ°é”™è¯¯æŠ¥å‘Šè¯´çŸ­åç§°æ˜¯ä¸å”¯ä¸€çš„ï¼Œè¿™ç§æƒ…å†µä¸‹å°±å¿…é¡»ä½¿ç”¨å®Œå…¨é™å®šåã€‚
>
> åŸæ–‡é“¾æ¥ï¼šhttps://blog.csdn.net/weixin_36210698/article/details/82992771

**mapperé‡Œé¢çš„å››ä¸ªæ ‡ç­¾`select`ã€`update`ã€`insert`å’Œ`delete`å¯¹åº”sqlçš„å¢æŸ¥åˆ æ”¹**

*å…·ä½“è¯·åˆ° https://mybatis.org/mybatis-3/zh/sqlmap-xml.html#insert_update_and_delete*

- select æ ‡ç­¾çš„å‡ ä¸ªé‡è¦å‚æ•°å‚æ•°
  - `id` æ–¹æ³•åç§°
  - `parameterType`  å‚æ•°ç±»
    - **å‚æ•°ç±»çš„ä½¿ç”¨ï¼šå‚æ•°ç±»éœ€è¦å’Œæ¥å£ä¸­å®šä¹‰çš„ä¸€æ ·ï¼Œåœ¨æ ‡ç­¾é‡Œä½¿ç”¨æ—¶è¦`${å‚æ•°åç§°(å’Œåœ¨æ¥å£ä¸­å®šä¹‰çš„ä¸€è‡´)}`ï¼›å¦‚æœå‚æ•°ç±»ä¸æ˜¯åŸºç¡€æ•°æ®ç±»å‹è€Œæ˜¯ä¸€ä¸ªæ­£å¸¸çš„ç±»çš„è¯ï¼Œåœ¨æ ‡ç­¾é‡Œä½¿ç”¨è¦`${ç±»çš„å‚æ•°åç§°}`ã€‚**æ¯”æ–¹è¯´ `resultType`æ˜¯`User`ï¼Œ`User`ç±»é‡Œé¢æœ‰`name`ã€`id`ã€`pwd`ä¸‰ä¸ªå‚æ•°ã€‚é‚£ä¹ˆåœ¨æ ‡ç­¾é‡Œå¡«å†™sqlè¯­å¥æ—¶è¦æ˜¯ç”¨`User`ç±»çš„å‚æ•°åº”è¯¥è¿™æ ·(å‡è®¾selectæ“ä½œ)ï¼š`select * from user where id=${id} and name=${name} and pwd=${pwd}`ã€‚*æ³¨æ„`${}`é‡Œé¢çš„å‚æ•°åç§°å’Œ`User`ç±»çš„å‚æ•°åç§°ä¸€è‡´*
    - ![image-20200415141238657](mybaits%20%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200415141238657.png)
  - `resultType` è¿”å›ç±»
- update delete insert çš„å‡ ä¸ªé‡è¦å‚æ•°
  - `id` æ–¹æ³•åç§°
  - `parameterType`  å‚æ•°ç±»

**mapper.xmlé…ç½®æ–‡ä»¶ğŸ‘‡**

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ssm.suyuesheng.mapper.UserMapper">
    <resultMap id="UserMap" type="ssm.suyuesheng.domain.User">
        <result column="pwd" property="password"/>
    </resultMap>
    <select id="findAll" resultMap="UserMap">
        select *  from user
    </select>

    <select id="findById" parameterType="_int" resultType="user">
        select id,name,pwd from user where id=#{id}
    </select>

    <delete id="removeById" parameterType="_int">
        delete from user where id=#{id}
    </delete>

    <update id="update" parameterType="user">
        update user set name=#{name},pwd=#{password} where id=#{id}
    </update>
</mapper>
```



**ä½¿ç”¨å®šä¹‰çš„sqlè¯­å¥**ğŸ‘‡

```java
public void TestCRUD(){
        //update
        SqlSession sqlSession = SqlsessionUtil.getSqlSession();
        UserDao mapper = sqlSession.getMapper(UserDao.class);
        User user = mapper.findById(5);
        user.setName("è€æ");
        user.setPwd("hesu1244");
        boolean update = mapper.update(user);
        System.out.println(update);
        sqlSession.commit();
        mapper.findAll().forEach(System.out::println);
        //delete
        mapper.remove(1);
        sqlSession.commit();

    }
```

**è¯·æ³¨æ„ï¼šå¢åˆ æ”¹æ“ä½œå®Œæˆåä¸€å®šè¦` sqlSession.commit();`æ¥æäº¤äº‹åŠ¡**

## 3.xmlé…ç½®

https://mybatis.org/mybatis-3/zh/configuration.html#environments

### é…ç½®æ–‡ä»¶çš„æ–‡æ¡£ç»“æ„

![image-20200416103707221](mybaits%20%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200416103707221.png)



### `properties`å’Œ`environments`é…ç½®

- `<properties resource="cn/ssm/suyuesheng/mybatisconfig.properties"/>`æŒ‡å®šäº†propertiesåå¯ä»¥åœ¨åé¢ä»¥`${å±æ€§åç§°}`æ¥ä½¿ç”¨å¦‚ğŸ‘‡

```xml
<environments default="development">
        <environment id="development">
            <transactionManager type="JDBC"/>
            <dataSource type="POOLED">
                <property name="driver" value="${driver}"/>
                <property name="url" value="${url}"/>
                <property name="username" value="${username}"/>
                <property name="password" value="su15990904343"/>
            </dataSource>
        </environment>
</environments>
```

propertiesæ ‡ç­¾å†…éƒ¨ä¹Ÿå¯å®šä¹‰å±æ€§ï¼Œå½“æ ‡ç­¾å®šä¹‰çš„å±æ€§å’Œresourceæ–‡ä»¶çš„å±æ€§å†²çªæ—¶ï¼Œä»¥resourceæŒ‡å®šçš„æ–‡ä»¶é‡Œçš„å±æ€§ä¹‹ä¸ºå‡†**ç›¸å…³å±æ€§æœ‰å¯èƒ½ä¼šå’Œpom.xmlå†²çªï¼Œè§£å†³å†²çªçš„åŠæ³•æœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯ä¿®æ”¹`.properties`æ–‡ä»¶é‡Œå±æ€§çš„åç§°ï¼ŒäºŒæ˜¯ä¿®æ”¹è¿‡æ»¤è§„åˆ™https://blog.csdn.net/u011781521/article/details/79052725**ã€‚æŒ‰ç¬”è®°ä¸­æåˆ°çš„è¿‡æ»¤é…ç½®æ–¹æ¡ˆå°±å¯ä»¥é¿å…è¿™ç§æƒ…å†µ

- `äº‹åŠ¡ç®¡ç†å™¨ï¼ˆtransactionManagerï¼‰`åŒ…æ‹¬JDBCå’ŒMANAGED 

- `datasource`æ•°æ®æ¥æºï¼Œtypeå±æ€§ï¼Œæœ‰ä¸‰ç§å†…å»ºçš„æ•°æ®æºç±»å‹ï¼ˆä¹Ÿå°±æ˜¯ `type="[UNPOOLED|POOLED|JNDI]"`ï¼‰ï¼šå¯ä»¥ç†è§£ä¸ºæ•°æ®åº“è¿æ¥æ± ï¼Œ`type="UNPOOLED"`å°±æ˜¯ä¸ç”¨è¿æ¥æ± ã€‚

- `environments`æ•…åæ€æ„æ”¯æŒå¤šä¸ª`environment`ï¼ˆ`environments`ä¸­æ–‡å¯ä»¥ç¿»è¯‘ä¸ºå·¥ä½œç¯å¢ƒï¼‰ã€‚ä½†åœ¨å·¥ä½œæ—¶åªèƒ½ç”¨ä¸€ä¸ª`environment`ï¼Œç”¨å“ªä¸ªå¯ä»¥åœ¨defaultå±æ€§é‡Œé¢è®¾ç½®ï¼Œå¦‚ä¸‹ğŸ‘‡

```xml
<environments default="development">
        <environment id="development">
            <transactionManager type="JDBC"/>
            <dataSource type="POOLED">
                <property name="driver" value="${driver}"/>
                <property name="url" value="${url}"/>
                <property name="username" value="${username}"/>
                <property name="password" value="${password}"/>
            </dataSource>
        </environment>
        <environment id="oracle">
            <transactionManager type="JDBC"></transactionManager>
            <dataSource type="POOLED">
                <property name="driver" value="${driver}"/>
            </dataSource>
        </environment>
</environments>
```

### ç±»å‹åˆ«åï¼ˆtypeAliasesï¼‰

ç±»å‹åˆ«åå¯ä¸º Java ç±»å‹è®¾ç½®ä¸€ä¸ªç¼©å†™åå­—ã€‚ å®ƒä»…ç”¨äº XML é…ç½®ï¼Œæ„åœ¨é™ä½å†—ä½™çš„å…¨é™å®šç±»åä¹¦å†™ã€‚å¦‚ä¸‹ğŸ‘‡ï¼Œå°†`cn.ssm.suyuesheng.domain.User`æŒ‡å®šä¸º`User`ï¼Œè¿™æ ·åœ¨`mapper`é…ç½®æ—¶æŒ‡å®šç±»å‹æ›´æ–¹ä¾¿

config.xml

```xml
<!--    æŒ‡å®šç±»å‹åˆ«å-->
    <typeAliases>
        <typeAlias type="cn.ssm.suyuesheng.domain.User" alias="User"/>
    </typeAliases>
```

Usermapper.xml

```xml
<select id="findById" parameterType="int" resultType="User">
    select * from user where id=#{id}
</select>
```

`package`æŒ‡å®šä½¿ç”¨çš„åŒ…ï¼Œåœ¨configé‡Œé¢çš„aliasesé‡ŒpackageæŒ‡å®šäº†ä½¿ç”¨çš„åŒ…ä¹‹åï¼Œä½¿ç”¨åŒ…é‡Œçš„ç±»å¯ä»¥ä½¿ç”¨ç±»åç§°é¦–å­—æ¯å°å†™ğŸ‘‡

config.xml

```xml
 <package name="cn.ssm.suyuesheng.domain"/>
```

Usermapper.xml

```xml
<!--    åœ¨configé‡Œé¢çš„aliasesé‡ŒpackageæŒ‡å®šäº†ä½¿ç”¨çš„åŒ…ä¹‹åï¼Œä½¿ç”¨åŒ…é‡Œçš„ç±»å¯ä»¥ä½¿ç”¨ç±»åç§°é¦–å­—æ¯å°å†™-->
    <insert id="insertUser" parameterType="user">
        insert into user values(#{id},#{name},#{pwd})
    </insert>
```

ä¹Ÿå¯ä½¿ç”¨æ³¨è§£æ¥å®šä¹‰åˆ«åï¼Œä½¿ç”¨äº†`package`åï¼Œåœ¨æ²¡æœ‰æ³¨è§£çš„æƒ…å†µä¸‹ï¼Œä¼šä½¿ç”¨ Bean çš„é¦–å­—æ¯å°å†™çš„éé™å®šç±»åæ¥ä½œä¸ºå®ƒçš„åˆ«åã€‚ æ¯”å¦‚ `domain.blog.Author` çš„åˆ«åä¸º `author`ï¼›è‹¥æœ‰æ³¨è§£ï¼Œåˆ™åˆ«åä¸ºå…¶æ³¨è§£å€¼ã€‚(æ­¤æ—¶ä½¿ç”¨å°å†™ä¾ç„¶å¯ä»¥)ğŸ‘‡

User.java

```java
@Alias("author")     //å¿…é¡»åœ¨typealiasæŒ‡å®špackageå@Alias("")æ‰ä¼šæœ‰æ•ˆæœ
public class User {
    private int id;
    private String name;
    private String pwd;
```

Usermapper.xml

```xml
<!--    ä½¿ç”¨äº†`package`åï¼Œåœ¨æ²¡æœ‰æ³¨è§£çš„æƒ…å†µä¸‹ï¼Œä¼šä½¿ç”¨ Bean çš„é¦–å­—æ¯å°å†™çš„éé™å®šç±»åæ¥ä½œä¸ºå®ƒçš„åˆ«åã€‚ æ¯”å¦‚ `domain.blog.Author` çš„åˆ«åä¸º `author`ï¼›è‹¥æœ‰æ³¨è§£ï¼Œåˆ™åˆ«åä¸ºå…¶æ³¨è§£å€¼ã€‚-->
    <update id="update" parameterType="author">
        UPDATE user SET pwd=#{pwd},name=#{name} where id=${id}
    </update>
```

ä¸ºä¸€äº›åŸºç¡€çš„ç±»å‹æä¾›äº†é»˜è®¤çš„åˆ«åğŸ‘‡

![image-20200417004836999](mybaits%20%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200417004836999.png)

### è®¾ç½® setting

æš‚æ—¶å…ˆè®°ä½ä¸‹é¢å‡ ä¸ª

![image-20200417013953299](mybaits%20%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200417013953299.png)

![image-20200417014056957](mybaits%20%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200417014056957.png)

### æ˜ å°„å™¨ mappers

![image-20200417020548244](mybaits%20%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200417020548244.png)

æ¨èä½¿ç”¨ç¬¬ä¸€ä¸ªï¼Œç¬¬äºŒä¸ªå¿½ç•¥ï¼Œç¬¬ä¸‰å’Œç¬¬å››ä¸ªæœ‰ä¸¤ä¸ªè¦æ±‚  **1.`mapper.xml`æ–‡ä»¶å¿…é¡»æ”¾åœ¨`src/main/java`é‡Œé¢ï¼›2.`mapper.xml`çš„å‘½åå¿…é¡»å’Œæ¥å£åä¸€æ ·ï¼Œæ¯”å¦‚æ¥å£åç§°`UserMapper.java`é‚£ä¹ˆxmlçš„åç§°åº”è¯¥æ˜¯`UserMapper.xml`ã€‚_éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè™½ç„¶åªæœ‰ä¸‰å’Œå››çš„æ“ä½œæ–¹å¼è¦æ±‚æ¥å£å’Œé…ç½®æ–‡ä»¶åç§°ä¸€è‡´ï¼Œä½†æ˜¯åº”è¯¥æŠŠè¿™ä¸€æ¡è¦æ±‚ä½œä¸ºä¸€ä¸ªè§„èŒƒï¼Œä¹Ÿå°±æ˜¯è¯´ä»¥åæ¥å£å’Œé…ç½®æ–‡ä»¶åç§°è¦ä¿æŒä¸€è‡´ _**

### other

å…ˆå¿½ç•¥

## 4.ç”Ÿå‘½å‘¨æœŸå’Œä½œç”¨åŸŸ

## 5.ç»“æœæ˜ å°„

```xml
<resultMap id="UserMap" type="ssm.suyuesheng.domain.User">
    <result column="pwd" property="password"/>
</resultMap>
```

## 6.æ—¥å¿—å·¥å‚

åœ¨config.xmlé‡Œé¢é…ç½®settings é‡Œé¢çš„setting

![image-20200417154336920](mybaits%20%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200417154336920.png)

- SLF4J 

- LOG4J ï¼ˆ**é‡ç‚¹**ï¼‰

- LOG4J2 

- JDK_LOGGING 

- COMMONS_LOGGING 

- STDOUT_LOGGING ï¼ˆ**é‡ç‚¹**ï¼‰

- NO_LOGGING

### LOG4J

 **åœ¨mybatisçš„config.xml**

```xml
<settings>
        <setting name="logImpl" value="LOG4J"/>
</settings>
```

**mavenå¯¼å…¥**

```xml
<!-- https://mvnrepository.com/artifact/log4j/log4j -->
<dependency>
    <groupId>log4j</groupId>
    <artifactId>log4j</artifactId>
    <version>1.2.17</version>
</dependency>
```

[log4jé…ç½®è¯¦è§£](https://www.jianshu.com/p/ccafda45bcea)

#### log4.properties

```properties
log4j.rootLogger=DEBUG,console,rollingFile
#è¡¨ç¤ºLoggerä¼šåœ¨çˆ¶Loggerçš„appenderé‡Œè¾“å‡ºï¼Œé»˜è®¤ä¸ºtrue
log4j.additivity.org.apache=true

# æ§åˆ¶å°(console)
log4j.appender.console=org.apache.log4j.ConsoleAppender
#æŒ‡å®šæ—¥å¿—ä¿¡æ¯çš„æœ€ä½è¾“å‡ºçº§åˆ«
log4j.appender.console.Threshold=DEBUG
#è¡¨ç¤ºæ‰€æœ‰æ¶ˆæ¯éƒ½ä¼šè¢«ç«‹å³è¾“å‡ºï¼Œè®¾ä¸ºfalseåˆ™ä¸è¾“å‡ºï¼Œé»˜è®¤å€¼æ˜¯true
log4j.appender.console.ImmediateFlush=true
#é»˜è®¤å€¼æ˜¯System.outã€‚
log4j.appender.console.Target=System.out
log4j.appender.console.layout=org.apache.log4j.PatternLayout
log4j.appender.console.layout.ConversionPattern=[%d{yyyy/MM/dd HH:mm:ss,SSS}][%c.%M]%p:%m%n


# å›æ»šæ–‡ä»¶(rollingFile)
log4j.appender.rollingFile=org.apache.log4j.RollingFileAppender
log4j.appender.rollingFile.Threshold=WARN
log4j.appender.rollingFile.ImmediateFlush=true
log4j.appender.rollingFile.Append=true
log4j.appender.rollingFile.File=D:/logs/log.log4j
log4j.appender.rollingFile.MaxFileSize=10mb
#æŒ‡å®šå¯ä»¥äº§ç”Ÿçš„æ»šåŠ¨æ–‡ä»¶çš„æœ€å¤§æ•°ï¼Œä¾‹å¦‚ï¼Œè®¾ä¸º2åˆ™å¯ä»¥äº§ç”Ÿlogging.log4j.1ï¼Œlogging.log4j.2ä¸¤ä¸ªæ»šåŠ¨æ–‡ä»¶å’Œä¸€ä¸ªlogging.log4jæ–‡ä»¶ã€‚
log4j.appender.rollingFile.MaxBackupIndex=50
log4j.appender.rollingFile.layout=org.apache.log4j.PatternLayout
log4j.appender.rollingFile.layout.ConversionPattern=[%-5p] %d(%r) --> [%t] %l: %m %x %n

# æ—¥å¿—è¾“å‡ºçº§åˆ«
log4j.logger.cn.ssm=DEBUG
log4j.logger.java.sql=DEBUG

```

[å…·ä½“çš„å†…å®¹å¯ä»¥åˆ°è¿™é‡Œ](https://www.jianshu.com/p/ccafda45bcea)

**åœ¨ä»£ç é‡Œé¢ä½¿ç”¨**

```java
Logger logger = Logger.getLogger(Thread.currentThread().getStackTrace()[1].getClass());
 public void testLogger(){
        logger.error("é”™è¯¯");
        logger.warn("haha");
    }
```

## 7.åˆ†é¡µ

### 7.1limit(é‡ç‚¹)

Dao

```java
    /**
     * åˆ†é¡µ
     * @param map
     * @return
     */
    List<User> limit(Map<String,Integer> map);
```

mapper.xml

```xml
<select id="limit" parameterType="map" resultMap="UserMap">
    select * from user limit #{startPage},#{size}
</select>
```

ä½¿ç”¨ğŸ‘‡

```java
@Test
public void testOne(){
    SqlSession sqlSession = SqlsessionUtil.getSqlSession();
    UserDao userDao = sqlSession.getMapper(UserDao.class);

    Map<String,Integer> map = new HashMap<String, Integer>();
    map.put("startPage", 0);
    map.put("size", 2);
    List<User> users = userDao.limit(map);
    System.out.println(users);
    sqlSession.commit();
    sqlSession.close();
    //        userDao.limit()
}
```



### 7.2rowboundï¼ˆé¢å‘å¯¹è±¡ï¼‰

### 7.3pagehelperï¼ˆæ’ä»¶ï¼‰

## 8.é¢å‘æ³¨è§£

![image-20200423062933070](2020-4-18%20mybaits%20%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%20171812.assets/image-20200423062933070.png)

```java
public interface UserMapper {

    List<User> findAll();

    @Insert("insert into user values(#{id},#{name},#{password})")
    boolean insert(User user);

    User findById(@Param("id") int id);
}
```

**ä»¥å`@param`å¦‚æœæ˜¯åŸºæœ¬æ•°æ®ç±»å‹å°±ç”¨ã€‚**

### $å’Œ#çš„åŒºåˆ«

https://blog.csdn.net/u013552450/article/details/72528498

![image-20200420222810999](image-20200420222810999.png)



## 9.lombok

### 9.1 ç®€ä»‹

> Lomboké¡¹ç›®æ˜¯ä¸€ä¸ªJavaåº“ï¼Œå®ƒä¼šè‡ªåŠ¨æ’å…¥ç¼–è¾‘å™¨å’Œæ„å»ºå·¥å…·ä¸­ï¼ŒLombokæä¾›äº†ä¸€ç»„æœ‰ç”¨çš„æ³¨é‡Šï¼Œç”¨æ¥æ¶ˆé™¤Javaç±»ä¸­çš„å¤§é‡æ ·æ¿ä»£ç ã€‚ä»…äº”ä¸ªå­—ç¬¦(@Data)å°±å¯ä»¥æ›¿æ¢æ•°ç™¾è¡Œä»£ç ä»è€Œäº§ç”Ÿå¹²å‡€ï¼Œç®€æ´ä¸”æ˜“äºç»´æŠ¤çš„Javaç±»ã€‚
>
> æ¥æºç™¾åº¦ç™¾ç§‘  https://baike.baidu.com/item/Lombok/23780246?fr=aladdin

### 9.2 å®‰è£…

*åœ¨ideaå®‰è£…*

![åœ¨ideaå®‰è£…](2020-4-18%20mybaits%20%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%20171812.assets/image-20200424162528788.png)

*å¯¼åŒ…*

```xml
<!-- https://mvnrepository.com/artifact/org.projectlombok/lombok -->
<dependency>
    <groupId>org.projectlombok</groupId>
    <artifactId>lombok</artifactId>
    <version>1.18.8</version>
    <!-- scope å¯ä»¥å»æ‰ -->
    <scope>provided</scope>
</dependency>
```

### 9.3 ä½¿ç”¨

> å¸¸ç”¨æ³¨è§£ï¼š
>
> @Setter ï¼šæ³¨è§£åœ¨ç±»æˆ–å­—æ®µï¼Œæ³¨è§£åœ¨ç±»æ—¶ä¸ºæ‰€æœ‰å­—æ®µç”Ÿæˆsetteræ–¹æ³•ï¼Œæ³¨è§£åœ¨å­—æ®µä¸Šæ—¶åªä¸ºè¯¥å­—æ®µç”Ÿæˆsetteræ–¹æ³•ã€‚
>
> @Getter ï¼šä½¿ç”¨æ–¹æ³•åŒä¸Šï¼ŒåŒºåˆ«åœ¨äºç”Ÿæˆçš„æ˜¯getteræ–¹æ³•ã€‚
>
> @ToString ï¼šæ³¨è§£åœ¨ç±»ï¼Œæ·»åŠ toStringæ–¹æ³•ã€‚
>
> @EqualsAndHashCodeï¼š æ³¨è§£åœ¨ç±»ï¼Œç”ŸæˆhashCodeå’Œequalsæ–¹æ³•ã€‚
>
> @NoArgsConstructorï¼š æ³¨è§£åœ¨ç±»ï¼Œç”Ÿæˆæ— å‚çš„æ„é€ æ–¹æ³•ã€‚
>
> @RequiredArgsConstructorï¼š æ³¨è§£åœ¨ç±»ï¼Œä¸ºç±»ä¸­éœ€è¦ç‰¹æ®Šå¤„ç†çš„å­—æ®µç”Ÿæˆæ„é€ æ–¹æ³•ï¼Œæ¯”å¦‚finalå’Œè¢«@NonNullæ³¨è§£çš„å­—æ®µã€‚
>
> @AllArgsConstructorï¼š æ³¨è§£åœ¨ç±»ï¼Œç”ŸæˆåŒ…å«ç±»ä¸­æ‰€æœ‰å­—æ®µçš„æ„é€ æ–¹æ³•ã€‚
>
> @Dataï¼š æ³¨è§£åœ¨ç±»ï¼Œç”Ÿæˆsetter/getterã€equalsã€canEqualã€hashCodeã€toStringæ–¹æ³•ï¼Œå¦‚ä¸ºfinalå±æ€§ï¼Œåˆ™ä¸ä¼šä¸ºè¯¥å±æ€§ç”Ÿæˆsetteræ–¹æ³•ã€‚
>
> @Slf4jï¼š æ³¨è§£åœ¨ç±»ï¼Œç”Ÿæˆlogå˜é‡ï¼Œä¸¥æ ¼æ„ä¹‰æ¥è¯´æ˜¯å¸¸é‡ã€‚

javaä»£ç è¿™æ ·å†™ğŸ‘‡

```java
@Alias("student")
@Data
@AllArgsConstructor
@NoArgsConstructor
public class User {
    private int id;
    private String name;
    private String password;
}
```

å› ä¸ºæ·»åŠ äº†å‡ ä¸ªæ³¨è§£ï¼Œå¥½å¤šæ–¹æ³•å°±è‡ªåŠ¨ç”Ÿæˆäº†ğŸ‘‡

![image-20200424164135826](2020-4-18%20mybaits%20%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%20171812.assets/image-20200424164135826.png)

## 10 å¤šå¯¹ä¸€

å‡è®¾å­¦ç”Ÿå’Œè€å¸ˆ è€å¸ˆä¸€ä¸ªï¼Œå­¦ç”Ÿå¤šä¸ª

### sqlè¯­å¥

```sql
show databases ;
use mybatisstudy;
show tables ;
select * from user;
show create table user;
create table `teacher`(
    `id` int primary key ,
    `name` varchar(20) not null
)default charset=utf8;
insert into teacher values (1,'è€ç¨‹');
select * from teacher;
create table `student`(
    `id` int primary key ,
    `name` varchar(20) not null ,
    `tid` int,
    constraint `t-sid` foreign key (`tid`) references `teacher` (`id`)
)default charset=utf8;
desc student;
insert into student values(1,'è€é»‘',1);
insert into student values(2,'è€æŸ³',1);
insert into student values(3,'è€å…­',1);
insert into student values(4,'è€è‹',1);
insert into student values(5,'è€æ',1);
select * from student;
```

*å…³ç³»ğŸ‘‡*

![image-20200424172054317](2020-4-18%20mybaits%20%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%20171812.assets/image-20200424172054317.png)

### ç¯å¢ƒæ­å»ºæµç¨‹

pom.xmlç»§æ‰¿çˆ¶pom.xml

1. å»ºç«‹å®ä½“ç±»

   1. ```java
      @Data
      @NoArgsConstructor
      @AllArgsConstructor
      public class Student {
          private int id;
          private String name;
          /**
           * å…³è”è€å¸ˆ
           */
          private Teacher teacher;
          private int tid;
      }
      ```

   2. ```java
      @Data
      @AllArgsConstructor
      @NoArgsConstructor
      public class Teacher {
          private int id;
          private String name;
      }
      ```

2. å»ºç«‹mapperæ¥å£

   1. ```java
      public interface StudentMapper {
      
          List<Student> findAll();
      
      
      }
      ```

   2. ```java
      public interface TeacherMapper {
      }
      ```

3. å»ºç«‹config.xml

   1. ```xml
      <?xml version="1.0" encoding="UTF-8" ?>
      <!DOCTYPE configuration
              PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
              "http://mybatis.org/dtd/mybatis-3-config.dtd">
      <configuration>
          <properties resource="mybatisconfig.properties"/>
          <settings>
              <setting name="logImpl" value="LOG4J"/>
          </settings>
          <typeAliases>
              <package name="ssm.suyuesheng.domain"/>
          </typeAliases>
          <environments default="development">
              <environment id="development">
                  <transactionManager type="JDBC"></transactionManager>
                  <dataSource type="POOLED">
                      <property name="driver" value="${driver}"/>
                      <property name="url" value="${url}"/>
                      <property name="username" value="${username}"/>
                      <property name="password" value="${password}"/>
                  </dataSource>
              </environment>
          </environments>
          <mappers>
              <package name="ssm.suyuesheng.mapper"/>
          </mappers>
      </configuration>
      ```

4. å»ºç«‹mapper.xml

   1. ```xml
      <?xml version="1.0" encoding="UTF-8" ?>
      <!DOCTYPE mapper
              PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
              "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
      <mapper namespace="ssm.suyuesheng.mapper.StudentMapper">
          <resultMap id="studentMap" type="ssm.suyuesheng.domain.Student">
      
          </resultMap>
      
          <select id="findAll" resultType="student">
              select * from student
          </select>
      </mapper>
      ```

   2. ```xml
      <?xml version="1.0" encoding="UTF-8" ?>
      <!DOCTYPE mapper
              PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
              "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
      <mapper namespace="ssm.suyuesheng.mapper.TeacherMapper">
      
      </mapper>
      ```

5. å®éªŒç¯å¢ƒæ­å»ºæ˜¯å¦æˆåŠŸ

   1. ```java
      package ssm.suyuesheng.mapper;
      
      import org.apache.ibatis.session.SqlSession;
      import org.junit.Test;
      import ssm.suyuesheng.util.SqlSessionUtil;
      
      public class TestStudent {
          @Test
          public void testStart(){
              SqlSession sqlSession = SqlSessionUtil.getSqlSession();
              StudentMapper mapper = sqlSession.getMapper(StudentMapper.class);
              System.out.println(mapper.findAll());
          }
      }
      ```