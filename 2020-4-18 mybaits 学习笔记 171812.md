# mybatis å­¦ä¹ ç¬”è®°

**è½¬è½½è¯·æ³¨æ˜æ¥æº https://www.cnblogs.com/sogeisetsu/  åŸæ–‡å¯ä»¥åˆ°çš„githubä¸‹è½½ [https://github.com/sogeisetsu/myBlog/blob/master/2020-4-18%20mybaits%20%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%20171812.md](https://github.com/sogeisetsu/myBlog/blob/master/2020-4-18 mybaits å­¦ä¹ ç¬”è®° 171812.md)**

[TOC]

## 0.ç®€ä»‹

> MyBatis æ˜¯ä¸€æ¬¾ä¼˜ç§€çš„æŒä¹…å±‚æ¡†æ¶ï¼Œå®ƒæ”¯æŒè‡ªå®šä¹‰ SQLã€å­˜å‚¨è¿‡ç¨‹ä»¥åŠé«˜çº§æ˜ å°„ã€‚MyBatis å…é™¤äº†å‡ ä¹æ‰€æœ‰çš„ JDBC ä»£ç ä»¥åŠè®¾ç½®å‚æ•°å’Œè·å–ç»“æœé›†çš„å·¥ä½œã€‚MyBatis å¯ä»¥é€šè¿‡ç®€å•çš„ XML æˆ–æ³¨è§£æ¥é…ç½®å’Œæ˜ å°„åŸå§‹ç±»å‹ã€æ¥å£å’Œ Java POJOï¼ˆPlain Old Java Objectsï¼Œæ™®é€šè€å¼ Java å¯¹è±¡ï¼‰ä¸ºæ•°æ®åº“ä¸­çš„è®°å½•ã€‚

## 1.ä¸‹è½½å®‰è£…

**GitHubï¼š[mybatis3.5.2](https://github.com/mybatis/mybatis-3/releases/download/mybatis-3.5.2/mybatis-3.5.2.zip)**

**ä¸­æ–‡æ–‡æ¡£ï¼š[mybatisä¸­æ–‡æ–‡æ¡£](https://mybatis.org/mybatis-3/zh/index.html)**

**mavenä»“åº“**

```xml
<!-- https://mvnrepository.com/artifact/org.mybatis/mybatis -->
<dependency>
    <groupId>org.mybatis</groupId>
    <artifactId>mybatis</artifactId>
    <version>3.5.2</version>
</dependency>

```

**pom.xml**

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <groupId>org.suyuesheng</groupId>
    <artifactId>osuo</artifactId>
    <version>1.0-SNAPSHOT</version>
    <repositories>
        <repository>
            <id>alimaven</id>
            <name>aliyun maven</name>
            <url>http://maven.aliyun.com/nexus/content/groups/public/</url>
            <releases>
                <enabled>true</enabled>
            </releases>
            <snapshots>
                <enabled>false</enabled>
            </snapshots>
        </repository>
    </repositories>
    <properties>
        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
        <maven.compiler.source>1.7</maven.compiler.source>
        <maven.compiler.target>1.7</maven.compiler.target>
    </properties>
    <dependencies>
        <dependency>
            <groupId>junit</groupId>
            <artifactId>junit</artifactId>
            <version>4.11</version>
            <scope>test</scope>
        </dependency>
        <dependency>
            <groupId>mysql</groupId>
            <artifactId>mysql-connector-java</artifactId>
            <version>8.0.19</version>
        </dependency>
        <dependency>
            <groupId>com.alibaba</groupId>
            <artifactId>druid</artifactId>
            <version>1.1.22</version>
        </dependency>
        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-core</artifactId>
            <version>4.1.2.RELEASE</version>
            <scope>compile</scope>
        </dependency>
        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-jdbc</artifactId>
            <version>4.1.2.RELEASE</version>
            <scope>compile</scope>
        </dependency>
        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-tx</artifactId>
            <version>4.1.2.RELEASE</version>
            <scope>compile</scope>
        </dependency>
        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-beans</artifactId>
            <version>4.1.2.RELEASE</version>
            <scope>compile</scope>
        </dependency>
        <dependency>
            <groupId>commons-logging</groupId>
            <artifactId>commons-logging</artifactId>
            <version>1.1.1</version>
            <scope>compile</scope>
        </dependency>
        <dependency>
            <groupId>org.mybatis</groupId>
            <artifactId>mybatis</artifactId>
            <version>3.5.2</version>
        </dependency>
        <dependency>
            <groupId>log4j</groupId>
            <artifactId>log4j</artifactId>
            <version>1.2.17</version>
        </dependency>
    </dependencies>

    <build>
        <resources>
            <resource>
                <directory>src/main/java</directory>
                <includes>
                    <include>**/*.xml</include>
                    <include>**/*.properties</include>
                </includes>
            </resource>
            <resource>
                <directory>src/main/resources</directory>
            </resource>
        </resources>
        <pluginManagement><!-- lock down plugins versions to avoid using Maven defaults (may be moved to parent pom) -->
            <plugins>
                <plugin>
                    <artifactId>maven-clean-plugin</artifactId>
                    <version>3.1.0</version>
                </plugin>
                <!-- see http://maven.apache.org/ref/current/maven-core/default-bindings.html#Plugin_bindings_for_war_packaging -->
                <plugin>
                    <artifactId>maven-resources-plugin</artifactId>
                    <version>3.0.2</version>
                </plugin>
                <plugin>
                    <artifactId>maven-surefire-plugin</artifactId>
                    <version>2.22.1</version>
                </plugin>
                <plugin>
                    <artifactId>maven-war-plugin</artifactId>
                    <version>3.2.2</version>
                </plugin>
                <plugin>
                    <artifactId>maven-install-plugin</artifactId>
                    <version>2.5.2</version>
                </plugin>
                <plugin>
                    <artifactId>maven-deploy-plugin</artifactId>
                    <version>2.8.2</version>
                </plugin>
                <plugin>
                    <groupId>org.apache.maven.plugins</groupId>
                    <artifactId>maven-compiler-plugin</artifactId>
                    <version>3.8.1</version>
                    <configuration>
                        <source>1.8</source>
                        <target>1.8</target>
                        <encoding>utf-8</encoding>
                    </configuration>
                </plugin>
                <plugin>

                    <groupId>org.apache.tomcat.maven</groupId>

                    <artifactId>tomcat7-maven-plugin</artifactId>

                    <version>2.2</version>

                </plugin>
            </plugins>
        </pluginManagement>
    </build>

</project>
```

**sql**

```sql
create database if not exists mybatisstudy character set utf8;
show variables like '%chara%';
use mybatisstudy;
create table user (
    id int not null primary key ,
    name varchar(20) not null ,
    pwd varchar(20) not null
) character set utf8;
desc user;
insert into user values (1,'è€å¼ ','1234567');
insert into user values (2,'laoliu','12233');
insert into user values (3,'æ€æ€','12233');
SELECT * FROM user;
```

### 1.1åˆ›å»ºæ¨¡å—

**mybatis.config.xml**

è¿™æ˜¯mybatisçš„é…ç½®æ–‡ä»¶

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE configuration
        PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-config.dtd">
<configuration>
    <environments default="development">
        <environment id="development">
            <transactionManager type="JDBC"/>
            <dataSource type="POOLED">
                <property name="driver" value="com.mysql.cj.jdbc.Driver"/>
                <property name="url" value="jdbc:mysql://localhost:3307/mybatisstudy?characterEncoding=utf-8&amp;useUnicode=true"/>
                <property name="username" value="root"/>
                <property name="password" value="su15990904343"/>
            </dataSource>
        </environment>
    </environments>
        <mappers>
            <mapper resource="UserMapper.xml"/>
        </mappers>
</configuration>
```

***å¤‡æ³¨ï¼šåœ¨xmlæ–‡ä»¶ä¸­ `&` éœ€è¦ç”¨` &amp;`æ¥è¡¨ç¤ºï¼Œå¦‚æœ `mysql-connector` çš„ç‰ˆæœ¬å¤§äº6ï¼Œdriveråº”è¯¥æ˜¯`com.mysql.cj.jdbc.Driver`ã€‚***

sqlsession çš„utilæ–‡ä»¶

```java
package cn.ssm.suyuesheng.utils;

import org.apache.ibatis.session.SqlSession;
import org.apache.ibatis.session.SqlSessionFactory;
import org.apache.ibatis.session.SqlSessionFactoryBuilder;

import java.io.InputStream;

public class SqlsessionUtil {
    private static SqlSession sqlSession;
    private static SqlSessionFactory sqlSessionFactory;

    static {
        InputStream resourceAsStream = SqlsessionUtil.class.getResourceAsStream("mybatis.config.xml");
        sqlSessionFactory = new SqlSessionFactoryBuilder().build(resourceAsStream);
        sqlSession = sqlSessionFactory.openSession();
    }

    public static SqlSession getSqlSession() {
        return sqlSession;
    }

    public static SqlSessionFactory getSqlSessionFactory() {
        return sqlSessionFactory;
    }
}

```

**mapperçš„é…ç½®   <a href="#mapperconfig">è·³è½¬åˆ°mapperè¯¦ç»†é…ç½®</a>**

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.ssm.suyuesheng.Dao.UserDao">
    <select id="findAll" resultType="cn.ssm.suyuesheng.domain.User">
    select * from user
  </select>
</mapper>
```

**æ³¨æ„ï¼š`namespace`  å’Œ`resultType`åº”è¯¥æŠŠè·¯å¾„å†™å…¨ï¼Œ`id`å¯¹åº”çš„æ˜¯æ–¹æ³•åç§°ï¼Œ`namespace`å¯¹åº”çš„æ˜¯DAOç±»(åœ¨mybatisé‡Œå«Mapperç±»)ã€‚_åœ¨è¿™é‡Œæˆ‘å°†`UserMapper.xml`æ”¾åœ¨äº†src/main/resourseé‡Œé¢ï¼Œå¦‚æœæŠŠ`UserMapper.xml`æ”¾åœ¨src/main/javaé‡Œé¢éœ€è¦åœ¨pom.xmlé‡Œé¢é…ç½®è¿‡æ»¤_**

#### è¿‡æ»¤è¿™æ ·é…ç½®

```xml
<resources>
      <resource>
        <directory>src/main/java</directory>
        <includes>
          <include>**/*.xml</include>
          <include>**/*.properties</include>
        </includes>
      </resource>
      <resource>
        <directory>src/main/resources</directory>
      </resource>
    </resources>
```

**`filtering`é»˜è®¤æ˜¯falseï¼Œæ•…ä¸é…ç½®`filtering`ã€‚å¾…åˆ°éœ€è¦çš„æ—¶å€™å¯ä»¥è‡ªè¡Œé…ç½®**

## 2 .ä½¿ç”¨æ¨¡å—

```java
package cn.ssm.suyuesheng.Dao;

import cn.ssm.suyuesheng.domain.User;
import cn.ssm.suyuesheng.utils.SqlsessionUtil;
import org.apache.ibatis.session.SqlSession;
import org.junit.Test;

import java.util.List;

public class UserDaoTest {
    @Test
    public void TestOne(){
        //æ–¹æ³•ä¸€
        SqlSession sqlSession = SqlsessionUtil.getSqlSession();
        UserDao mapper = sqlSession.getMapper(UserDao.class);
        List<User> users = mapper.findAll();
        System.out.println(users);
        sqlSession.close();
    }
    @Test
    public void TestTwo(){
        //æ–¹å¼äºŒ
        SqlSession sqlSession = SqlsessionUtil.getSqlSession();
        List<User> list = sqlSession.selectList("cn.ssm.suyuesheng.Dao.UserDao.findAll");
        for (User user : list) {
            System.out.println(user);
        }
    }
}

```

### 2.1mapper(æ˜ å°„å™¨)è¯¦ç»†é…ç½®

*å‚è€ƒèµ„æ–™   https://mybatis.org/mybatis-3/zh/sqlmap-xml.html#insert_update_and_delete*

#### 2.1.1 crudçš„å®ç°

**æ¥å£**

```java
package cn.ssm.suyuesheng.Dao;

import cn.ssm.suyuesheng.domain.User;

import java.util.List;

public interface UserDao {
    List<User> findAll();

    User findById(int id);

    boolean insertUser(User user);

    boolean update(User user);

    boolean remove(int id);
}

```

è¿™ä¸ªæ¥å£æœ‰å¢æŸ¥åˆ æ”¹ç­‰åŠŸèƒ½ï¼ŒåŠŸèƒ½çš„å®ç°è¦åˆ°å¯¹åº”mapperçš„xmlæ–‡ä»¶å»å£°æ˜

#### 2.1.2**UserMapper.xml**ğŸ‘‡

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.ssm.suyuesheng.Dao.UserDao">
<!--    findAllæ–¹æ³•-->
    <select id="findAll" resultType="cn.ssm.suyuesheng.domain.User">
    select * from user
    </select>

<!-- findById-->
    <select id="findById" parameterType="int" resultType="cn.ssm.suyuesheng.domain.User">
        select * from user where id=#{id}
    </select>
<!-- insertUser-->
    <insert id="insertUser" parameterType="cn.ssm.suyuesheng.domain.User">
        insert into user values(#{id},#{name},#{pwd})
    </insert>
<!-- update-->
    <update id="update" parameterType="cn.ssm.suyuesheng.domain.User">
        UPDATE user SET pwd=#{pwd},name=#{name} where id=${id}
    </update>
<!-- remove-->
    <delete id="remove" parameterType="int" >
        delete from user where id=${id}
    </delete>
</mapper>
```

**namespace**  å¯¹åº”æ¥å£åç§°

> å‘½åè§£æ: ä¸ºäº†å‡å°‘è¾“å…¥é‡ï¼ŒMyBatiså¯¹æ‰€æœ‰çš„å‘½åé…ç½®å…ƒç´ (åŒ…æ‹¬è¯­å¥ï¼Œç»“æœæ˜ å°„ï¼Œç¼“å­˜ç­‰)ä½¿ç”¨äº†å¦‚ä¸‹çš„å‘½åè§£æè§„åˆ™ã€‚
>
> - å®Œå…¨é™å®šå(æ¯”å¦‚"com.mypackage.MyMapper.selectAllThings")å°†è¢«ç›´æ¥æŸ¥æ‰¾å¹¶ä¸”æ‰¾åˆ°å³ç”¨ã€‚
> - çŸ­åç§°(æ¯”å¦‚"selectAllThings")å¦‚æœå…¨å±€å”¯ä¸€ä¹Ÿå¯ä»¥ä½œä¸ºä¸€ä¸ªå•ç‹¬çš„å¼•ç”¨ã€‚å¦‚æœä¸å”¯ä¸€ï¼Œæœ‰ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„ç›¸åŒåç§°(æ¯”å¦‚â€œcom.foo.selectAllThings â€å’Œâ€œcom.bar.selectAllThingsâ€), é‚£ä¹ˆä½¿ç”¨æ—¶å°±ä¼šæ”¶åˆ°é”™è¯¯æŠ¥å‘Šè¯´çŸ­åç§°æ˜¯ä¸å”¯ä¸€çš„ï¼Œè¿™ç§æƒ…å†µä¸‹å°±å¿…é¡»ä½¿ç”¨å®Œå…¨é™å®šåã€‚
>
> åŸæ–‡é“¾æ¥ï¼šhttps://blog.csdn.net/weixin_36210698/article/details/82992771

**mapperé‡Œé¢çš„å››ä¸ªæ ‡ç­¾`select`ã€`update`ã€`insert`å’Œ`delete`å¯¹åº”sqlçš„å¢æŸ¥åˆ æ”¹**

*å…·ä½“è¯·åˆ° https://mybatis.org/mybatis-3/zh/sqlmap-xml.html#insert_update_and_delete*

- select æ ‡ç­¾çš„å‡ ä¸ªé‡è¦å‚æ•°å‚æ•°
  - `id` æ–¹æ³•åç§°
  - `parameterType`  å‚æ•°ç±»
    - **å‚æ•°ç±»çš„ä½¿ç”¨ï¼šå‚æ•°ç±»éœ€è¦å’Œæ¥å£ä¸­å®šä¹‰çš„ä¸€æ ·ï¼Œåœ¨æ ‡ç­¾é‡Œä½¿ç”¨æ—¶è¦`${å‚æ•°åç§°(å’Œåœ¨æ¥å£ä¸­å®šä¹‰çš„ä¸€è‡´)}`ï¼›å¦‚æœå‚æ•°ç±»ä¸æ˜¯åŸºç¡€æ•°æ®ç±»å‹è€Œæ˜¯ä¸€ä¸ªæ­£å¸¸çš„ç±»çš„è¯ï¼Œåœ¨æ ‡ç­¾é‡Œä½¿ç”¨è¦`${ç±»çš„å‚æ•°åç§°}`ã€‚**æ¯”æ–¹è¯´ `resultType`æ˜¯`User`ï¼Œ`User`ç±»é‡Œé¢æœ‰`name`ã€`id`ã€`pwd`ä¸‰ä¸ªå‚æ•°ã€‚é‚£ä¹ˆåœ¨æ ‡ç­¾é‡Œå¡«å†™sqlè¯­å¥æ—¶è¦æ˜¯ç”¨`User`ç±»çš„å‚æ•°åº”è¯¥è¿™æ ·(å‡è®¾selectæ“ä½œ)ï¼š`select * from user where id=${id} and name=${name} and pwd=${pwd}`ã€‚*æ³¨æ„`${}`é‡Œé¢çš„å‚æ•°åç§°å’Œ`User`ç±»çš„å‚æ•°åç§°ä¸€è‡´*
    - ![image-20200415141238657](https://raw.githubusercontent.com/sogeisetsu/typoraimage/master/image-20200415141238657.png)
  - `resultType` è¿”å›ç±»
- update delete insert çš„å‡ ä¸ªé‡è¦å‚æ•°
  - `id` æ–¹æ³•åç§°
  - `parameterType`  å‚æ•°ç±»

**mapper.xmlé…ç½®æ–‡ä»¶ğŸ‘‡**

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ssm.suyuesheng.mapper.UserMapper">
    <resultMap id="UserMap" type="ssm.suyuesheng.domain.User">
        <result column="pwd" property="password"/>
    </resultMap>
    <select id="findAll" resultMap="UserMap">
        select *  from user
    </select>

    <select id="findById" parameterType="_int" resultType="user">
        select id,name,pwd from user where id=#{id}
    </select>

    <delete id="removeById" parameterType="_int">
        delete from user where id=#{id}
    </delete>

    <update id="update" parameterType="user">
        update user set name=#{name},pwd=#{password} where id=#{id}
    </update>
</mapper>
```



**ä½¿ç”¨å®šä¹‰çš„sqlè¯­å¥**ğŸ‘‡

```java
public void TestCRUD(){
        //update
        SqlSession sqlSession = SqlsessionUtil.getSqlSession();
        UserDao mapper = sqlSession.getMapper(UserDao.class);
        User user = mapper.findById(5);
        user.setName("è€æ");
        user.setPwd("hesu1244");
        boolean update = mapper.update(user);
        System.out.println(update);
        sqlSession.commit();
        mapper.findAll().forEach(System.out::println);
        //delete
        mapper.remove(1);
        sqlSession.commit();

    }
```

**è¯·æ³¨æ„ï¼šå¢åˆ æ”¹æ“ä½œå®Œæˆåä¸€å®šè¦` sqlSession.commit();`æ¥æäº¤äº‹åŠ¡**

## 3.xmlé…ç½®

https://mybatis.org/mybatis-3/zh/configuration.html#environments

### é…ç½®æ–‡ä»¶çš„æ–‡æ¡£ç»“æ„

![image-20200416103707221](https://raw.githubusercontent.com/sogeisetsu/typoraimage/master/image-20200417013953299.png)



### `properties`å’Œ`environments`é…ç½®

- `<properties resource="cn/ssm/suyuesheng/mybatisconfig.properties"/>`æŒ‡å®šäº†propertiesåå¯ä»¥åœ¨åé¢ä»¥`${å±æ€§åç§°}`æ¥ä½¿ç”¨å¦‚ğŸ‘‡

```xml
<environments default="development">
        <environment id="development">
            <transactionManager type="JDBC"/>
            <dataSource type="POOLED">
                <property name="driver" value="${driver}"/>
                <property name="url" value="${url}"/>
                <property name="username" value="${username}"/>
                <property name="password" value="su15990904343"/>
            </dataSource>
        </environment>
</environments>
```

propertiesæ ‡ç­¾å†…éƒ¨ä¹Ÿå¯å®šä¹‰å±æ€§ï¼Œå½“æ ‡ç­¾å®šä¹‰çš„å±æ€§å’Œresourceæ–‡ä»¶çš„å±æ€§å†²çªæ—¶ï¼Œä»¥resourceæŒ‡å®šçš„æ–‡ä»¶é‡Œçš„å±æ€§ä¹‹ä¸ºå‡†**ç›¸å…³å±æ€§æœ‰å¯èƒ½ä¼šå’Œpom.xmlå†²çªï¼Œè§£å†³å†²çªçš„åŠæ³•æœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯ä¿®æ”¹`.properties`æ–‡ä»¶é‡Œå±æ€§çš„åç§°ï¼ŒäºŒæ˜¯ä¿®æ”¹è¿‡æ»¤è§„åˆ™https://blog.csdn.net/u011781521/article/details/79052725**ã€‚æŒ‰ç¬”è®°ä¸­æåˆ°çš„è¿‡æ»¤é…ç½®æ–¹æ¡ˆå°±å¯ä»¥é¿å…è¿™ç§æƒ…å†µ

- `äº‹åŠ¡ç®¡ç†å™¨ï¼ˆtransactionManagerï¼‰`åŒ…æ‹¬JDBCå’ŒMANAGED 

- `datasource`æ•°æ®æ¥æºï¼Œtypeå±æ€§ï¼Œæœ‰ä¸‰ç§å†…å»ºçš„æ•°æ®æºç±»å‹ï¼ˆä¹Ÿå°±æ˜¯ `type="[UNPOOLED|POOLED|JNDI]"`ï¼‰ï¼šå¯ä»¥ç†è§£ä¸ºæ•°æ®åº“è¿æ¥æ± ï¼Œ`type="UNPOOLED"`å°±æ˜¯ä¸ç”¨è¿æ¥æ± ã€‚

- `environments`æ•…åæ€æ„æ”¯æŒå¤šä¸ª`environment`ï¼ˆ`environments`ä¸­æ–‡å¯ä»¥ç¿»è¯‘ä¸ºå·¥ä½œç¯å¢ƒï¼‰ã€‚ä½†åœ¨å·¥ä½œæ—¶åªèƒ½ç”¨ä¸€ä¸ª`environment`ï¼Œç”¨å“ªä¸ªå¯ä»¥åœ¨defaultå±æ€§é‡Œé¢è®¾ç½®ï¼Œå¦‚ä¸‹ğŸ‘‡

```xml
<environments default="development">
        <environment id="development">
            <transactionManager type="JDBC"/>
            <dataSource type="POOLED">
                <property name="driver" value="${driver}"/>
                <property name="url" value="${url}"/>
                <property name="username" value="${username}"/>
                <property name="password" value="${password}"/>
            </dataSource>
        </environment>
        <environment id="oracle">
            <transactionManager type="JDBC"></transactionManager>
            <dataSource type="POOLED">
                <property name="driver" value="${driver}"/>
            </dataSource>
        </environment>
</environments>
```

### ç±»å‹åˆ«åï¼ˆtypeAliasesï¼‰

ç±»å‹åˆ«åå¯ä¸º Java ç±»å‹è®¾ç½®ä¸€ä¸ªç¼©å†™åå­—ã€‚ å®ƒä»…ç”¨äº XML é…ç½®ï¼Œæ„åœ¨é™ä½å†—ä½™çš„å…¨é™å®šç±»åä¹¦å†™ã€‚å¦‚ä¸‹ğŸ‘‡ï¼Œå°†`cn.ssm.suyuesheng.domain.User`æŒ‡å®šä¸º`User`ï¼Œè¿™æ ·åœ¨`mapper`é…ç½®æ—¶æŒ‡å®šç±»å‹æ›´æ–¹ä¾¿

config.xml

```xml
<!--    æŒ‡å®šç±»å‹åˆ«å-->
    <typeAliases>
        <typeAlias type="cn.ssm.suyuesheng.domain.User" alias="User"/>
    </typeAliases>
```

Usermapper.xml

```xml
<select id="findById" parameterType="int" resultType="User">
    select * from user where id=#{id}
</select>
```

`package`æŒ‡å®šä½¿ç”¨çš„åŒ…ï¼Œåœ¨configé‡Œé¢çš„aliasesé‡ŒpackageæŒ‡å®šäº†ä½¿ç”¨çš„åŒ…ä¹‹åï¼Œä½¿ç”¨åŒ…é‡Œçš„ç±»å¯ä»¥ä½¿ç”¨ç±»åç§°é¦–å­—æ¯å°å†™ğŸ‘‡

config.xml

```xml
 <package name="cn.ssm.suyuesheng.domain"/>
```

Usermapper.xml

```xml
<!--    åœ¨configé‡Œé¢çš„aliasesé‡ŒpackageæŒ‡å®šäº†ä½¿ç”¨çš„åŒ…ä¹‹åï¼Œä½¿ç”¨åŒ…é‡Œçš„ç±»å¯ä»¥ä½¿ç”¨ç±»åç§°é¦–å­—æ¯å°å†™-->
    <insert id="insertUser" parameterType="user">
        insert into user values(#{id},#{name},#{pwd})
    </insert>
```

ä¹Ÿå¯ä½¿ç”¨æ³¨è§£æ¥å®šä¹‰åˆ«åï¼Œä½¿ç”¨äº†`package`åï¼Œåœ¨æ²¡æœ‰æ³¨è§£çš„æƒ…å†µä¸‹ï¼Œä¼šä½¿ç”¨ Bean çš„é¦–å­—æ¯å°å†™çš„éé™å®šç±»åæ¥ä½œä¸ºå®ƒçš„åˆ«åã€‚ æ¯”å¦‚ `domain.blog.Author` çš„åˆ«åä¸º `author`ï¼›è‹¥æœ‰æ³¨è§£ï¼Œåˆ™åˆ«åä¸ºå…¶æ³¨è§£å€¼ã€‚(æ­¤æ—¶ä½¿ç”¨å°å†™ä¾ç„¶å¯ä»¥)ğŸ‘‡

User.java

```java
@Alias("author")     //å¿…é¡»åœ¨typealiasæŒ‡å®špackageå@Alias("")æ‰ä¼šæœ‰æ•ˆæœ
public class User {
    private int id;
    private String name;
    private String pwd;
```

Usermapper.xml

```xml
<!--    ä½¿ç”¨äº†`package`åï¼Œåœ¨æ²¡æœ‰æ³¨è§£çš„æƒ…å†µä¸‹ï¼Œä¼šä½¿ç”¨ Bean çš„é¦–å­—æ¯å°å†™çš„éé™å®šç±»åæ¥ä½œä¸ºå®ƒçš„åˆ«åã€‚ æ¯”å¦‚ `domain.blog.Author` çš„åˆ«åä¸º `author`ï¼›è‹¥æœ‰æ³¨è§£ï¼Œåˆ™åˆ«åä¸ºå…¶æ³¨è§£å€¼ã€‚-->
    <update id="update" parameterType="author">
        UPDATE user SET pwd=#{pwd},name=#{name} where id=${id}
    </update>
```

ä¸ºä¸€äº›åŸºç¡€çš„ç±»å‹æä¾›äº†é»˜è®¤çš„åˆ«åğŸ‘‡

![image-20200417004836999](https://raw.githubusercontent.com/sogeisetsu/typoraimage/master/image-20200416103707221.png)

### è®¾ç½® setting

æš‚æ—¶å…ˆè®°ä½ä¸‹é¢å‡ ä¸ª

![image-20200417013953299](https://raw.githubusercontent.com/sogeisetsu/typoraimage/master/image-20200417154336920.png)

![image-20200417014056957](https://raw.githubusercontent.com/sogeisetsu/typoraimage/master/image-20200417014056957.png)

### æ˜ å°„å™¨ mappers

![image-20200417020548244](https://raw.githubusercontent.com/sogeisetsu/typoraimage/master/image-20200417020548244.png)

æ¨èä½¿ç”¨ç¬¬ä¸€ä¸ªï¼Œç¬¬äºŒä¸ªå¿½ç•¥ï¼Œç¬¬ä¸‰å’Œç¬¬å››ä¸ªæœ‰ä¸¤ä¸ªè¦æ±‚  **1.`mapper.xml`æ–‡ä»¶å¿…é¡»æ”¾åœ¨`src/main/java`é‡Œé¢ï¼›2.`mapper.xml`çš„å‘½åå¿…é¡»å’Œæ¥å£åä¸€æ ·ï¼Œæ¯”å¦‚æ¥å£åç§°`UserMapper.java`é‚£ä¹ˆxmlçš„åç§°åº”è¯¥æ˜¯`UserMapper.xml`ã€‚_éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè™½ç„¶åªæœ‰ä¸‰å’Œå››çš„æ“ä½œæ–¹å¼è¦æ±‚æ¥å£å’Œé…ç½®æ–‡ä»¶åç§°ä¸€è‡´ï¼Œä½†æ˜¯åº”è¯¥æŠŠè¿™ä¸€æ¡è¦æ±‚ä½œä¸ºä¸€ä¸ªè§„èŒƒï¼Œä¹Ÿå°±æ˜¯è¯´ä»¥åæ¥å£å’Œé…ç½®æ–‡ä»¶åç§°è¦ä¿æŒä¸€è‡´ _**

### other

å…ˆå¿½ç•¥

## 4.ç”Ÿå‘½å‘¨æœŸå’Œä½œç”¨åŸŸ

## 5.ç»“æœæ˜ å°„

```xml
<resultMap id="UserMap" type="ssm.suyuesheng.domain.User">
    <result column="pwd" property="password"/>
</resultMap>
```

## 6.æ—¥å¿—å·¥å‚

åœ¨config.xmlé‡Œé¢é…ç½®settings é‡Œé¢çš„setting

![image-20200417154336920](https://raw.githubusercontent.com/sogeisetsu/typoraimage/master/image-20200423062933070.png)

- SLF4J 

- LOG4J ï¼ˆ**é‡ç‚¹**ï¼‰

- LOG4J2 

- JDK_LOGGING 

- COMMONS_LOGGING 

- STDOUT_LOGGING ï¼ˆ**é‡ç‚¹**ï¼‰

- NO_LOGGING

### LOG4J

 **åœ¨mybatisçš„config.xml**

```xml
<settings>
        <setting name="logImpl" value="LOG4J"/>
</settings>
```

**mavenå¯¼å…¥**

```xml
<!-- https://mvnrepository.com/artifact/log4j/log4j -->
<dependency>
    <groupId>log4j</groupId>
    <artifactId>log4j</artifactId>
    <version>1.2.17</version>
</dependency>
```

[log4jé…ç½®è¯¦è§£](https://www.jianshu.com/p/ccafda45bcea)

#### log4.properties

```properties
log4j.rootLogger=DEBUG,console,rollingFile
#è¡¨ç¤ºLoggerä¼šåœ¨çˆ¶Loggerçš„appenderé‡Œè¾“å‡ºï¼Œé»˜è®¤ä¸ºtrue
log4j.additivity.org.apache=true

# æ§åˆ¶å°(console)
log4j.appender.console=org.apache.log4j.ConsoleAppender
#æŒ‡å®šæ—¥å¿—ä¿¡æ¯çš„æœ€ä½è¾“å‡ºçº§åˆ«
log4j.appender.console.Threshold=DEBUG
#è¡¨ç¤ºæ‰€æœ‰æ¶ˆæ¯éƒ½ä¼šè¢«ç«‹å³è¾“å‡ºï¼Œè®¾ä¸ºfalseåˆ™ä¸è¾“å‡ºï¼Œé»˜è®¤å€¼æ˜¯true
log4j.appender.console.ImmediateFlush=true
#é»˜è®¤å€¼æ˜¯System.outã€‚
log4j.appender.console.Target=System.out
log4j.appender.console.layout=org.apache.log4j.PatternLayout
log4j.appender.console.layout.ConversionPattern=[%d{yyyy/MM/dd HH:mm:ss,SSS}][%c.%M]%p:%m%n


# å›æ»šæ–‡ä»¶(rollingFile)
log4j.appender.rollingFile=org.apache.log4j.RollingFileAppender
log4j.appender.rollingFile.Threshold=WARN
log4j.appender.rollingFile.ImmediateFlush=true
log4j.appender.rollingFile.Append=true
log4j.appender.rollingFile.File=D:/logs/log.log4j
log4j.appender.rollingFile.MaxFileSize=10mb
#æŒ‡å®šå¯ä»¥äº§ç”Ÿçš„æ»šåŠ¨æ–‡ä»¶çš„æœ€å¤§æ•°ï¼Œä¾‹å¦‚ï¼Œè®¾ä¸º2åˆ™å¯ä»¥äº§ç”Ÿlogging.log4j.1ï¼Œlogging.log4j.2ä¸¤ä¸ªæ»šåŠ¨æ–‡ä»¶å’Œä¸€ä¸ªlogging.log4jæ–‡ä»¶ã€‚
log4j.appender.rollingFile.MaxBackupIndex=50
log4j.appender.rollingFile.layout=org.apache.log4j.PatternLayout
log4j.appender.rollingFile.layout.ConversionPattern=[%-5p] %d(%r) --> [%t] %l: %m %x %n

# æ—¥å¿—è¾“å‡ºçº§åˆ«
log4j.logger.cn.ssm=DEBUG
log4j.logger.java.sql=DEBUG

```

[å…·ä½“çš„å†…å®¹å¯ä»¥åˆ°è¿™é‡Œ](https://www.jianshu.com/p/ccafda45bcea)

**åœ¨ä»£ç é‡Œé¢ä½¿ç”¨**

```java
Logger logger = Logger.getLogger(Thread.currentThread().getStackTrace()[1].getClass());
 public void testLogger(){
        logger.error("é”™è¯¯");
        logger.warn("haha");
    }
```

## 7.åˆ†é¡µ

### 7.1limit(é‡ç‚¹)

Dao

```java
    /**
     * åˆ†é¡µ
     * @param map
     * @return
     */
    List<User> limit(Map<String,Integer> map);
```

mapper.xml

```xml
<select id="limit" parameterType="map" resultMap="UserMap">
    select * from user limit #{startPage},#{size}
</select>
```

ä½¿ç”¨ğŸ‘‡

```java
@Test
public void testOne(){
    SqlSession sqlSession = SqlsessionUtil.getSqlSession();
    UserDao userDao = sqlSession.getMapper(UserDao.class);

    Map<String,Integer> map = new HashMap<String, Integer>();
    map.put("startPage", 0);
    map.put("size", 2);
    List<User> users = userDao.limit(map);
    System.out.println(users);
    sqlSession.commit();
    sqlSession.close();
    //        userDao.limit()
}
```



### 7.2rowboundï¼ˆé¢å‘å¯¹è±¡ï¼‰

### 7.3pagehelperï¼ˆæ’ä»¶ï¼‰

## 8.é¢å‘æ³¨è§£

![image-20200423062933070](https://raw.githubusercontent.com/sogeisetsu/typoraimage/master/image-20200420222810999.png)

```java
public interface UserMapper {

    List<User> findAll();

    @Insert("insert into user values(#{id},#{name},#{password})")
    boolean insert(User user);

    User findById(@Param("id") int id);
}
```

**ä»¥å`@param`å¦‚æœæ˜¯åŸºæœ¬æ•°æ®ç±»å‹å°±ç”¨ã€‚**

### $å’Œ#çš„åŒºåˆ«

https://blog.csdn.net/u013552450/article/details/72528498

![image-20200420222810999](https://raw.githubusercontent.com/sogeisetsu/typoraimage/master/image-20200417004836999.png)



## 9.lombok

### 9.1 ç®€ä»‹

> Lomboké¡¹ç›®æ˜¯ä¸€ä¸ªJavaåº“ï¼Œå®ƒä¼šè‡ªåŠ¨æ’å…¥ç¼–è¾‘å™¨å’Œæ„å»ºå·¥å…·ä¸­ï¼ŒLombokæä¾›äº†ä¸€ç»„æœ‰ç”¨çš„æ³¨é‡Šï¼Œç”¨æ¥æ¶ˆé™¤Javaç±»ä¸­çš„å¤§é‡æ ·æ¿ä»£ç ã€‚ä»…äº”ä¸ªå­—ç¬¦(@Data)å°±å¯ä»¥æ›¿æ¢æ•°ç™¾è¡Œä»£ç ä»è€Œäº§ç”Ÿå¹²å‡€ï¼Œç®€æ´ä¸”æ˜“äºç»´æŠ¤çš„Javaç±»ã€‚
>
> æ¥æºç™¾åº¦ç™¾ç§‘  https://baike.baidu.com/item/Lombok/23780246?fr=aladdin

### 9.2 å®‰è£…

*åœ¨ideaå®‰è£…*

![image-20200424172054317](https://raw.githubusercontent.com/sogeisetsu/typoraimage/master/image-20200424162528788.png)

*å¯¼åŒ…*

```xml
<!-- https://mvnrepository.com/artifact/org.projectlombok/lombok -->
<dependency>
    <groupId>org.projectlombok</groupId>
    <artifactId>lombok</artifactId>
    <version>1.18.8</version>
    <!-- scope å¯ä»¥å»æ‰ -->
    <scope>provided</scope>
</dependency>
```

### 9.3 ä½¿ç”¨

> å¸¸ç”¨æ³¨è§£ï¼š
>
> @Setter ï¼šæ³¨è§£åœ¨ç±»æˆ–å­—æ®µï¼Œæ³¨è§£åœ¨ç±»æ—¶ä¸ºæ‰€æœ‰å­—æ®µç”Ÿæˆsetteræ–¹æ³•ï¼Œæ³¨è§£åœ¨å­—æ®µä¸Šæ—¶åªä¸ºè¯¥å­—æ®µç”Ÿæˆsetteræ–¹æ³•ã€‚
>
> @Getter ï¼šä½¿ç”¨æ–¹æ³•åŒä¸Šï¼ŒåŒºåˆ«åœ¨äºç”Ÿæˆçš„æ˜¯getteræ–¹æ³•ã€‚
>
> @ToString ï¼šæ³¨è§£åœ¨ç±»ï¼Œæ·»åŠ toStringæ–¹æ³•ã€‚
>
> @EqualsAndHashCodeï¼š æ³¨è§£åœ¨ç±»ï¼Œç”ŸæˆhashCodeå’Œequalsæ–¹æ³•ã€‚
>
> @NoArgsConstructorï¼š æ³¨è§£åœ¨ç±»ï¼Œç”Ÿæˆæ— å‚çš„æ„é€ æ–¹æ³•ã€‚
>
> @RequiredArgsConstructorï¼š æ³¨è§£åœ¨ç±»ï¼Œä¸ºç±»ä¸­éœ€è¦ç‰¹æ®Šå¤„ç†çš„å­—æ®µç”Ÿæˆæ„é€ æ–¹æ³•ï¼Œæ¯”å¦‚finalå’Œè¢«@NonNullæ³¨è§£çš„å­—æ®µã€‚
>
> @AllArgsConstructorï¼š æ³¨è§£åœ¨ç±»ï¼Œç”ŸæˆåŒ…å«ç±»ä¸­æ‰€æœ‰å­—æ®µçš„æ„é€ æ–¹æ³•ã€‚
>
> @Dataï¼š æ³¨è§£åœ¨ç±»ï¼Œç”Ÿæˆsetter/getterã€equalsã€canEqualã€hashCodeã€toStringæ–¹æ³•ï¼Œå¦‚ä¸ºfinalå±æ€§ï¼Œåˆ™ä¸ä¼šä¸ºè¯¥å±æ€§ç”Ÿæˆsetteræ–¹æ³•ã€‚
>
> @Slf4jï¼š æ³¨è§£åœ¨ç±»ï¼Œç”Ÿæˆlogå˜é‡ï¼Œä¸¥æ ¼æ„ä¹‰æ¥è¯´æ˜¯å¸¸é‡ã€‚

javaä»£ç è¿™æ ·å†™ğŸ‘‡

```java
@Alias("student")
@Data
@AllArgsConstructor
@NoArgsConstructor
public class User {
    private int id;
    private String name;
    private String password;
}
```

å› ä¸ºæ·»åŠ äº†å‡ ä¸ªæ³¨è§£ï¼Œå¥½å¤šæ–¹æ³•å°±è‡ªåŠ¨ç”Ÿæˆäº†ğŸ‘‡

![image-20200424164135826](https://raw.githubusercontent.com/sogeisetsu/typoraimage/master/image-20200424164135826.png)

## 10 å¤šå¯¹ä¸€

https://www.jianshu.com/p/018c0f083501

å‡è®¾å­¦ç”Ÿå’Œè€å¸ˆ è€å¸ˆä¸€ä¸ªï¼Œå­¦ç”Ÿå¤šä¸ª

### 10.1 sqlè¯­å¥

```sql
show databases ;
use mybatisstudy;
show tables ;
select * from user;
show create table user;
create table `teacher`(
    `id` int primary key ,
    `name` varchar(20) not null
)default charset=utf8;
insert into teacher values (1,'è€ç¨‹');
select * from teacher;
create table `student`(
    `id` int primary key ,
    `name` varchar(20) not null ,
    `tid` int,
    constraint `t-sid` foreign key (`tid`) references `teacher` (`id`)
)default charset=utf8;
desc student;
insert into student values(1,'è€é»‘',1);
insert into student values(2,'è€æŸ³',1);
insert into student values(3,'è€å…­',1);
insert into student values(4,'è€è‹',1);
insert into student values(5,'è€æ',1);
select * from student;
```

*å…³ç³»ğŸ‘‡*

![åœ¨ideaå®‰è£…](https://raw.githubusercontent.com/sogeisetsu/typoraimage/master/image-20200424172054317.png)

### 10.2 ç¯å¢ƒæ­å»ºæµç¨‹

pom.xmlç»§æ‰¿çˆ¶pom.xml

1. å»ºç«‹å®ä½“ç±»

   1. ```java
      @Data
      @NoArgsConstructor
      @AllArgsConstructor
      public class Student {
          private int id;
          private String name;
          /**
           * å…³è”è€å¸ˆ
           */
          private Teacher teacher;
          private int tid;
      }
      ```

   2. ```java
      @Data
      @AllArgsConstructor
      @NoArgsConstructor
      public class Teacher {
          private int id;
          private String name;
      }
      ```

2. å»ºç«‹mapperæ¥å£

   1. ```java
      public interface StudentMapper {
      
          List<Student> findAll();
      
      
      }
      ```

   2. ```java
      public interface TeacherMapper {
      }
      ```

3. å»ºç«‹config.xml

   1. ```xml
      <?xml version="1.0" encoding="UTF-8" ?>
      <!DOCTYPE configuration
              PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
              "http://mybatis.org/dtd/mybatis-3-config.dtd">
      <configuration>
          <properties resource="mybatisconfig.properties"/>
          <settings>
              <setting name="logImpl" value="LOG4J"/>
          </settings>
          <typeAliases>
              <package name="ssm.suyuesheng.domain"/>
          </typeAliases>
          <environments default="development">
              <environment id="development">
                  <transactionManager type="JDBC"></transactionManager>
                  <dataSource type="POOLED">
                      <property name="driver" value="${driver}"/>
                      <property name="url" value="${url}"/>
                      <property name="username" value="${username}"/>
                      <property name="password" value="${password}"/>
                  </dataSource>
              </environment>
          </environments>
          <mappers>
              <package name="ssm.suyuesheng.mapper"/>
          </mappers>
      </configuration>
      ```

4. å»ºç«‹mapper.xml

   1. ```xml
      <?xml version="1.0" encoding="UTF-8" ?>
      <!DOCTYPE mapper
              PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
              "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
      <mapper namespace="ssm.suyuesheng.mapper.StudentMapper">
          <resultMap id="studentMap" type="ssm.suyuesheng.domain.Student">
      
          </resultMap>
      
          <select id="findAll" resultType="student">
              select * from student
          </select>
      </mapper>
      ```

   2. ```xml
      <?xml version="1.0" encoding="UTF-8" ?>
      <!DOCTYPE mapper
              PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
              "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
      <mapper namespace="ssm.suyuesheng.mapper.TeacherMapper">
      
      </mapper>
      ```

5. å®éªŒç¯å¢ƒæ­å»ºæ˜¯å¦æˆåŠŸ

   1. ```java
      package ssm.suyuesheng.mapper;
      
      import org.apache.ibatis.session.SqlSession;
      import org.junit.Test;
      import ssm.suyuesheng.util.SqlSessionUtil;
      
      public class TestStudent {
          @Test
          public void testStart(){
              SqlSession sqlSession = SqlSessionUtil.getSqlSession();
              StudentMapper mapper = sqlSession.getMapper(StudentMapper.class);
              System.out.println(mapper.findAll());
          }
      }
      ```

### 10.3 åµŒå¥—æŸ¥è¯¢

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ssm.suyuesheng.mapper.StudentMapper">

<!--æŒ‰æŸ¥è¯¢åµŒå¥—å¤„ç†-->
    <resultMap id="studentMap" type="ssm.suyuesheng.domain.Student">
        <result property="id" column="id"></result>
        <result property="name" column="name"></result>
        <result property="tid" column="tid"/>
        <association property="teacher" column="tid" javaType="teacher" select="getTeacher"/>
    </resultMap>

    <select id="findAll" resultMap="studentMap">
        select * from student
    </select>

    <select id="getTeacher" resultType="teacher">
        select * from teacher where id=#{tid}
    </select>

<!--æŒ‰ç»“æœåµŒå¥—å¤„ç†-->
    <resultMap id="studentMap2" type="student">
        <result property="id" column="sid"/>
        <result property="name" column="sname"/>
        <result property="tid" column="tid" ></result>
        <association property="teacher" javaType="teacher">
            <result property="name" column="tname"></result>
            <result property="id" column="tid"/>
        </association>
    </resultMap>
    <select id="findAll2" resultMap="studentMap2">
        select s.id sid,s.name sname,t.name tname,s.tid tid
        from student s,teacher t 
        where s.tid=t.id;
    </select>
</mapper>
```



## 11 ä¸€å¯¹å¤š

æ¥10

```java
package ssm.suyuesheng.domain;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.util.List;

@Data
@AllArgsConstructor
@NoArgsConstructor
public class Teacher {
    private int id;
    private String name;
    private List<Student> students;
}
```



collection çš„ç”¨æ³•,è¦æŒ‡å®šofTypeä½œä¸ºé›†åˆé‡Œé¢å¯¹è±¡çš„ç±»ï¼ŒjavaTypeåœ¨collectionæ˜¯ArrayListï¼Œï¼ˆæŸäº›æƒ…å†µä¸‹å¯ä»¥ä¸å†™javatypeï¼‰

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ssm.suyuesheng.mapper.TeacherMapper">

    <resultMap id="teacherMap" type="teacher">
        <result property="id" column="tid"/>
        <result property="name" column="tname"/>
        <collection property="students" ofType="student"  resultMap="ssm.suyuesheng.mapper.StudentMapper.studentMap2">
        </collection>
    </resultMap>
    <select id="getTeacherById" resultMap="teacherMap" parameterType="_int">
        select s.id sid,s.name sname,s.tid tid,t.name tname
        from student s, teacher t
        where s.tid=t.id and t.id=#{tid}
    </select>

</mapper>
```

## 12 .åŠ¨æ€sql

### 12.1æ­å»ºç¯å¢ƒ

#### sql

```sql
create table `blog`(
    `id` varchar(50) not null comment'åšå®¢id',
    `title` varchar(100) not null comment 'åšå®¢é¢˜ç›®',
    `author` varchar(30) not null comment 'ä½œè€…',
    `creat_time` datetime not null comment 'åˆ›å»ºæ—¶é—´',
    `views` int(30) not null comment 'æµè§ˆé‡'
)default charset=utf8;
show tables ;
insert into blog values('01','hello world','sogei','2000-01-01',12);
insert into blog values('02','idea how to use','liusann','2004-05-01 10:05',12);
insert into blog values('03','ä½ å¥½ä¸–ç•Œ','sogei','2006-01-01',123);
insert into blog values('04','MATLABä½¿ç”¨æ–¹æ³•','liusann','2007-01-01',122);
insert into blog values('05','WHAT IS JDBC','sogei','2007-10-01',122);
insert into blog values('06','INTO JDK1.8','liusann','2004-06-01 10:05',123);
insert into blog values('07','CREATE A WEBSITE BY USING BOOTSTRAP ','sogei','2020-01-01',122);
insert into blog values('08','æ¯çŒªçš„äº§åæŠ¤ç†','æœ¬å±±','2010-01-01',121);
```

#### mavenç¯å¢ƒæ­å»º

å‚è€ƒä¹‹å‰çš„ï¼Œæ— éå°±æ˜¯å¤åˆ¶é»è´´

*å°çŸ¥è¯†ï¼šå¼€å¯é©¼å³°å‘½åè½¬æ¢*

```xml
    <settings>
        <setting name="logImpl" value="LOG4J"/>
        <setting name="mapUnderscoreToCamelCase" value="true"/>
    </settings>
```

### 12.2` if`

```xml
 <select id="queryBlog" parameterType="map" resultType="blog">
        select * from mybatisstudy.blog where 1=1
        <if test="title!=null">
            and title=#{title}
        </if>
        <if test="author!=null">
            and author=#{author}
        </if>
        <if test="views!=null">
            and views=#{views}
        </if>
        <if test="creatTime!=null">
            and creat_time=#{creatTime}
        </if>
    </select>
```

### 12.3 `where`

> *where* å…ƒç´ åªä¼šåœ¨å­å…ƒç´ è¿”å›ä»»ä½•å†…å®¹çš„æƒ…å†µä¸‹æ‰æ’å…¥ â€œWHEREâ€ å­å¥ã€‚è€Œä¸”ï¼Œè‹¥å­å¥çš„å¼€å¤´ä¸º â€œANDâ€ æˆ– â€œORâ€ï¼Œ*where* å…ƒç´ ä¹Ÿä¼šå°†å®ƒä»¬å»é™¤ã€‚

```xml
<select id="queryBlog" parameterType="map" resultType="blog">
        select * from mybatisstudy.blog
        <where>
            <if test="title!=null">
                title=#{title}
            </if>
            <if test="author!=null">
                and author=#{author}
            </if>
            <if test="views!=null">
                and views=#{views}
            </if>
            <if test="creatTime!=null">
                and creat_time=#{creatTime}
            </if>
        </where>
    </select>

```

### 12.4 `choose`ã€ `when `ã€`otherwise`

> æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬ä¸æƒ³ä½¿ç”¨æ‰€æœ‰çš„æ¡ä»¶ï¼Œè€Œåªæ˜¯æƒ³ä»å¤šä¸ªæ¡ä»¶ä¸­é€‰æ‹©ä¸€ä¸ªä½¿ç”¨ã€‚é’ˆå¯¹è¿™ç§æƒ…å†µï¼ŒMyBatis æä¾›äº† choose å…ƒç´ ï¼Œå®ƒæœ‰ç‚¹åƒ Java ä¸­çš„ switch è¯­å¥ã€‚
>
> è¿˜æ˜¯ä¸Šé¢çš„ä¾‹å­ï¼Œä½†æ˜¯ç­–ç•¥å˜ä¸ºï¼šä¼ å…¥äº† â€œtitleâ€ å°±æŒ‰ â€œtitleâ€ æŸ¥æ‰¾ï¼Œä¼ å…¥äº† â€œauthorâ€ å°±æŒ‰ â€œauthorâ€ æŸ¥æ‰¾çš„æƒ…å½¢ã€‚è‹¥ä¸¤è€…éƒ½æ²¡æœ‰ä¼ å…¥ï¼Œå°±è¿”å›æ ‡è®°ä¸º featured çš„ BLOGï¼ˆè¿™å¯èƒ½æ˜¯ç®¡ç†å‘˜è®¤ä¸ºï¼Œä¸å…¶è¿”å›å¤§é‡çš„æ— æ„ä¹‰éšæœº Blogï¼Œè¿˜ä¸å¦‚è¿”å›ä¸€äº›ç”±ç®¡ç†å‘˜æŒ‘é€‰çš„ Blogï¼‰ã€‚

```xml
<select id="queryBlogChoose" parameterType="map" resultType="blog">
    select * from mybatisstudy.blog
    <where>
        <choose>
            <when test="title!=null">
                title=#{title}
            </when>
            <when test="author!=null">
                and author=#{author}
            </when>
            <when test="creatTime!=null">
                and creat_time=#{creatTime}
            </when>
            <otherwise>
                and views=#{views}
            </otherwise>
        </choose>
    </where>
</select>
```

**å³ä½¿chooseé‡Œé¢çš„æ‰€æœ‰æ¡ä»¶éƒ½æ»¡è¶³ï¼Œåœ¨ç”Ÿæˆsqlè¯­å¥æ—¶ä¹Ÿåªç”¨ä¸€ä¸ªï¼Œè¿™å’Œswitchå¾ˆåƒ**

### 12.5 `set`

ç”¨äºæ›´æ–°

```xml
<update id="upadteSet" parameterType="blog">
    update mybatisstudy.blog
    <set>
        <if test="author!=null">
            author=#{author},
        </if>
        <if test="creatTime!=null">
            creat_time=#{creatTime},
        </if>
        <if test="title!=null">
            title=#{title},
        </if>
        <if test="views!=null">
            views=#{views}
        </if>
    </set>
    <where>
        <choose>
            <when test="id!=null">
                id=#{id}
            </when>
            <otherwise>
                id=ceshi
            </otherwise>
        </choose>
    </where>
</update>
```

### é—®é¢˜ï¼š **å…³äºmybatiså†™mapper.xmlæ—¶ whereã€setã€ifç­‰æ ‡ç­¾ä¸­`and`å’Œ`,`çš„é—®é¢˜**

> *set* å…ƒç´ ä¼šåŠ¨æ€åœ°åœ¨è¡Œé¦–æ’å…¥ SET å…³é”®å­—ï¼Œå¹¶ä¼šåˆ æ‰é¢å¤–çš„é€—å·
>
> *where* å…ƒç´ åªä¼šåœ¨å­å…ƒç´ è¿”å›ä»»ä½•å†…å®¹çš„æƒ…å†µä¸‹æ‰æ’å…¥ â€œWHEREâ€ å­å¥ã€‚è€Œä¸”ï¼Œè‹¥å­å¥çš„å¼€å¤´ä¸º â€œANDâ€ æˆ– â€œORâ€ï¼Œ*where* å…ƒç´ ä¹Ÿä¼šå°†å®ƒä»¬å»é™¤ã€‚
>
> æ¥è‡ª https://mybatis.org/mybatis-3/zh/dynamic-sql.html

æŸ¥è¯¢æ–‡æ¡£å¯çŸ¥ï¼Œmybatisçš„æ‰€è°“æ™ºèƒ½åªå¯ä»¥åˆ é™¤åŠ¨æ€sqlé‡Œé¢é¢å¤–çš„ä¸œè¥¿ï¼Œè€Œä¸ä¼šå¢åŠ ä»€ä¹ˆï¼Œæ¯”å¦‚ä¸‹é¢çš„ä»£ç ğŸ‘‡,å¿…ç„¶ä¼šå‡ºé”™ï¼Œå› ä¸ºandä¸ä¼šå‡­ç©ºå‡ºç°ï¼Œsqlè¯­å¥å¯èƒ½ä¼šæ˜¯`select * from mybatisstudy.blog where title= ? author=?`æ²¡æœ‰`and`è¿™å¿…ç„¶å‡ºé”™

```xml
<select id="queryBlog" parameterType="map" resultType="blog">
    select * from mybatisstudy.blog
    <where>
        <if test="title!=null">
            title=#{title}
        </if>
        <if test="author!=null">
            author=#{author}
        </if>
        <if test="views!=null">
            views=#{views}
        </if>
        <if test="creatTime!=null">
            creat_time=#{creatTime}
        </if>
    </where>
</select>
```

### 12.6 `trim`

> å¦‚æœ *where* å…ƒç´ ä¸ä½ æœŸæœ›çš„ä¸å¤ªä¸€æ ·ï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡è‡ªå®šä¹‰ trim å…ƒç´ æ¥å®šåˆ¶ *where* å…ƒç´ çš„åŠŸèƒ½ã€‚
>
> ä¸ *set* å…ƒç´ **ç­‰ä»·**çš„è‡ªå®šä¹‰ *trim* å…ƒç´ 
>
> æ¥æº https://mybatis.org/mybatis-3/zh/dynamic-sql.html

å…ˆçœ‹ä¸ªä¾‹å­ğŸ‘‡

```xml
<select id="queryBlog" parameterType="map" resultType="blog">
    select * from mybatisstudy.blog
    <trim prefix="WHERE" prefixOverrides="AND |OR">
        <if test="title!=null">
            title=#{title}
        </if>
        <if test="author!=null">
            and author=#{author}
        </if>
        <if test="views!=null">
            and views=#{views}
        </if>
        <if test="creatTime!=null">
            and creat_time=#{creatTime}
        </if>
    </trim>
</select>
```

> *prefixOverrides* å±æ€§ä¼šå¿½ç•¥é€šè¿‡ç®¡é“ç¬¦åˆ†éš”çš„æ–‡æœ¬åºåˆ—ï¼ˆæ³¨æ„æ­¤ä¾‹ä¸­çš„ç©ºæ ¼æ˜¯å¿…è¦çš„ï¼‰ã€‚ä¸Šè¿°ä¾‹å­ä¼šç§»é™¤æ‰€æœ‰ *prefixOverrides* å±æ€§ä¸­æŒ‡å®šçš„å†…å®¹ï¼Œå¹¶ä¸”æ’å…¥ *prefix* å±æ€§ä¸­æŒ‡å®šçš„å†…å®¹ã€‚

*`prefixOverrides`* çš„æ„æ€æ˜¯ä¼šè‡ªåŠ¨åˆ é™¤çš„å‰ç¼€åŒ…æ‹¬å“ªäº›å†…å®¹

![](https://raw.githubusercontent.com/sogeisetsu/typoraimage/master/20200426214200.png)

`suffixOverrides`çš„æ„æ€æ˜¯ä¼šè‡ªåŠ¨åˆ é™¤çš„åç¼€åŒ…æ‹¬å“ªäº›å†…å®¹ï¼Œåœ¨`set`æ ‡ç­¾é‡Œé¢ä¼šè‡ªåŠ¨åˆ é™¤çš„å°±æ˜¯`,`äº†

ç”¨`trim`çš„ä¸€ä¸ªä¾‹å­ğŸ‘‡

```xml
<update id="upadteSet" parameterType="blog">
    update mybatisstudy.blog
    <trim prefix="SET" suffixOverrides=",">
        <if test="author!=null">
            author=#{author},
        </if>
        <if test="creatTime!=null">
            creat_time=#{creatTime},
        </if>
        <if test="title!=null">
            title=#{title},
        </if>
        <if test="views!=null">
            views=#{views},
        </if>
    </trim>
    <trim prefix="WHERE" prefixOverrides="AND |OR">
        <choose>
            <when test="id!=null">
                id=#{id}
            </when>
            <otherwise>
                id=ceshi
            </otherwise>
        </choose>
    </trim>
</update>
```

### 12.7 `froeach`

> åŠ¨æ€ SQL çš„å¦ä¸€ä¸ªå¸¸è§ä½¿ç”¨åœºæ™¯æ˜¯å¯¹é›†åˆè¿›è¡Œéå†ï¼ˆå°¤å…¶æ˜¯åœ¨æ„å»º IN æ¡ä»¶è¯­å¥çš„æ—¶å€™ï¼‰ã€‚æ¯”å¦‚ï¼š
>
> ```xml
>  <select id="selectPostIn" resultType="domain.blog.Post">
>   SELECT *
>   FROM POST P
>   WHERE ID in
>   <foreach item="item" index="index" collection="list"
>       open="(" separator="," close=")">
>         #{item}
>   </foreach>
> </select>
> 
>```
> 

mapper.xmlğŸ‘‡ã€‚ä¸€ä¸ªé›†åˆé‡Œé¢æœ‰ä¸€ä¸ªvalueä¸ºlisté›†åˆï¼Œkeyä¸ºidsçš„ä¸€æ¡ã€‚separatorä¸ºåˆ†éš”ç¬¦

```xml
<select id="queryForeach" parameterType="map" resultType="blog">
    select * from mybatisstudy.blog
    <where>
        <foreach collection="ids" item="id" open="(" separator="or" close=")">
            id=#{id}
        </foreach>
    </where>
</select>
```

javaä»£ç ğŸ‘‡

```java
@Test
public void testQuForeach(){
    SqlSession sqlSession = SqlSessionUtil.getSqlSession();
    BlogMapper mapper = sqlSession.getMapper(BlogMapper.class);
    HashMap hashMap = new HashMap();
    List<String> ids = new ArrayList<>();
    ids.add("01");
    ids.add("03");
    hashMap.put("ids", ids);
    System.out.println(hashMap);
    try {
        //            System.out.println(mapper.queryForeach(hashMap));
        mapper.queryForeach(hashMap).forEach(System.out::println);
    } catch (Exception e) {
        e.printStackTrace();
    }
    sqlSession.close();
}
```

mapperè¯­å¥æœ€ç»ˆè½¬åŒ–ä¸º`select * from mybatisstudy.blog WHERE ( id=? or id=? )`

æ—¥å¿—ğŸ‘‡

```
[2020/04/28 00:48:01,873]DEBUG:==>  Preparing: select * from mybatisstudy.blog WHERE ( id=? or id=? ) 
[2020/04/28 00:48:01,904]DEBUG:==> Parameters: 01(String), 03(String)
[2020/04/28 00:48:01,928]DEBUG:<==      Total: 2
Blog(id=01, title=hello world, author=sogei, creatTime=Sat Jan 01 00:00:00 CST 2000, views=12)
Blog(id=03, title=ä½ å¥½ä¸–ç•Œ, author=sogei, creatTime=Sun Jan 01 00:00:00 CST 2006, views=123)
```



### 12.8 `include `ä»£ç å¤ç”¨

åœ¨mapper.xmlé‡Œé¢`sql`å’Œ`include`ç›¸ç»“åˆå¯ä»¥è¿›è¡Œä»£ç å¤ç”¨ ,`sql`æ ‡ç­¾æŒ‡å®šidåç§°ï¼Œ`include`æ ‡ç­¾ç”¨`refid`å±æ€§å»æŒ‡å®š`sql`æ ‡ç­¾é‡Œé¢çš„å†…å®¹ï¼Œè¾¾åˆ°ä»£ç å¤ç”¨çš„æ•ˆæœã€‚

```xml
<sql id="queryBlogcopy">
    <if test="title!=null">
        title=#{title}
    </if>
    <if test="author!=null">
        and author=#{author}
    </if>
    <if test="views!=null">
        and views=#{views}
    </if>
    <if test="creatTime!=null">
        and creat_time=#{creatTime}
    </if>
</sql>
<select id="queryBlog" parameterType="map" resultType="blog">
    select * from mybatisstudy.blog
    <trim prefix="WHERE" prefixOverrides="AND |OR">
        <include refid="queryBlogcopy"/>
    </trim>
</select>
```



## 13 ç¼“å­˜

**ä»€ä¹ˆæ˜¯ç¼“å­˜ï¼Ÿ**

> ç¼“å­˜æŠ€æœ¯æ˜¯ä¸€ç§â€œä»¥ç©ºé—´æ¢æ—¶é—´â€çš„è®¾è®¡ç†å¿µï¼Œ**æ˜¯åˆ©ç”¨å†…å­˜ç©ºé—´èµ„æºæ¥æé«˜æ•°æ®æ£€ç´¢é€Ÿåº¦çš„æœ‰æ•ˆæ‰‹æ®µä¹‹ä¸€**ã€‚MybatisåŒ…å«ä¸€ä¸ªéå¸¸å¼ºå¤§çš„æŸ¥è¯¢ç¼“å­˜ç‰¹æ€§ï¼Œå¯ä»¥éå¸¸æ–¹ä¾¿åœ°é…ç½®å’Œå®šåˆ¶ã€‚MyBatiså°†æ•°æ®ç¼“å­˜è®¾è®¡æˆä¸¤çº§ç»“æ„ï¼Œåˆ†ä¸ºä¸€çº§ç¼“å­˜ã€äºŒçº§ç¼“å­˜.
>
> 
>
> ä½œè€…ï¼šä¸çŸ¥åçš„è›‹æŒ
> é“¾æ¥ï¼šhttps://www.jianshu.com/p/097e959874d1
> æ¥æºï¼šç®€ä¹¦

**mybatisä¸­çš„ç¼“å­˜ï¼Ÿ**

> åŸºæœ¬ä¸Šå°±æ˜¯è¿™æ ·ã€‚è¿™ä¸ªç®€å•è¯­å¥çš„æ•ˆæœå¦‚ä¸‹:
>
> - **æ˜ å°„è¯­å¥æ–‡ä»¶ä¸­çš„æ‰€æœ‰ select è¯­å¥çš„ç»“æœå°†ä¼šè¢«ç¼“å­˜ã€‚**
> - **æ˜ å°„è¯­å¥æ–‡ä»¶ä¸­çš„æ‰€æœ‰ insertã€update å’Œ delete è¯­å¥ä¼šåˆ·æ–°ç¼“å­˜ã€‚**
> - ç¼“å­˜ä¼šä½¿ç”¨æœ€è¿‘æœ€å°‘ä½¿ç”¨ç®—æ³•ï¼ˆLRU, Least Recently Usedï¼‰ç®—æ³•æ¥æ¸…é™¤ä¸éœ€è¦çš„ç¼“å­˜ã€‚
> - **ç¼“å­˜ä¸ä¼šå®šæ—¶è¿›è¡Œåˆ·æ–°**ï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œæ²¡æœ‰åˆ·æ–°é—´éš”ï¼‰ã€‚
> - ç¼“å­˜ä¼šä¿å­˜åˆ—è¡¨æˆ–å¯¹è±¡ï¼ˆæ— è®ºæŸ¥è¯¢æ–¹æ³•è¿”å›å“ªç§ï¼‰çš„ 1024 ä¸ªå¼•ç”¨ã€‚
> - ç¼“å­˜ä¼šè¢«è§†ä¸ºè¯»/å†™ç¼“å­˜ï¼Œè¿™æ„å‘³ç€è·å–åˆ°çš„å¯¹è±¡å¹¶ä¸æ˜¯å…±äº«çš„ï¼Œå¯ä»¥å®‰å…¨åœ°è¢«è°ƒç”¨è€…ä¿®æ”¹ï¼Œè€Œä¸å¹²æ‰°å…¶ä»–è°ƒç”¨è€…æˆ–çº¿ç¨‹æ‰€åšçš„æ½œåœ¨ä¿®æ”¹ã€‚
>
> æ¥æº https://mybatis.org/mybatis-3/zh/sqlmap-xml.html

#### ä¸€äºŒçº§ç¼“å­˜åŒºåˆ«

![](https://img-blog.csdn.net/20150726164148424?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center)

### 13.1 ä¸€çº§ç¼“å­˜(æœ¬åœ°ç¼“å­˜)

**ä¸€çº§ç¼“å­˜æ˜¯é»˜è®¤å¼€å¯çš„ï¼Œåªåœ¨ä¸€æ¬¡sqlsessioné‡Œé¢æœ‰æ•ˆ(ä»è·å¾—sqsessionåˆ°close sqlsession)ï¼Œä¸€çº§ç¼“å­˜æ— æ³•å…³é—­**

javaä»£ç ğŸ‘‡

```java
/**
     *æ£€æµ‹ä¸€çº§ç¼“å­˜
     */
@Test
public void testOneH(){
    SqlSession sqlSession = SqlSessionUtil.getSqlSession();
    BlogMapper mapper = sqlSession.getMapper(BlogMapper.class);

    mapper.findAll().forEach(System.out::println);
    System.out.println(">=====================");
    //åœ¨è¿è¡Œä¸€émapper.findAll()
    mapper.findAll().forEach(System.out::println);
    sqlSession.close();
}
```



æ—¥å¿—ğŸ‘‡

```
[2020/04/28 13:15:59,139]DEBUG:==>  Preparing: select * from mybatisstudy.blog 
[2020/04/28 13:15:59,172]DEBUG:==> Parameters: 
[2020/04/28 13:15:59,205]DEBUG:<==      Total: 16
Blog(id=01, title=hello world, author=sogei, creatTime=Sat Jan 01 00:00:00 CST 2000, views=12)
Blog(id=02, title=idea how to use, author=liusann, creatTime=Sat May 01 10:05:00 CST 2004, views=12)
Blog(id=03, title=ä½ å¥½ä¸–ç•Œ, author=sogei, creatTime=Sun Jan 01 00:00:00 CST 2006, views=123)
Blog(id=04, title=MATLABä½¿ç”¨æ–¹æ³•, author=liusann, creatTime=Mon Jan 01 00:00:00 CST 2007, views=122)
Blog(id=05, title=WHAT IS JDBC, author=sogei, creatTime=Mon Oct 01 00:00:00 CST 2007, views=122)
Blog(id=06, title=INTO JDK1.8, author=liusann, creatTime=Tue Jun 01 10:05:00 CST 2004, views=123)
Blog(id=07, title=CREATE A WEBSITE BY USING BOOTSTRAP , author=sogei, creatTime=Wed Jan 01 00:00:00 CST 2020, views=122)
Blog(id=08, title=è·Ÿæ–°, author=so update, creatTime=Sun Apr 26 21:46:03 CST 2020, views=34)
Blog(id=a0e433ab127b488b9fe81d368907b72e, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 20:53:43 CST 2020, views=12)
Blog(id=7124224de5104fffbb9119a75219cb00, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 20:55:23 CST 2020, views=12)
Blog(id=85d4af0c11424a428d7db43e54ec55eb, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 20:56:15 CST 2020, views=12)
Blog(id=7334ed8c220e454f861909b32eb01da6, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 20:56:43 CST 2020, views=12)
Blog(id=872eac5dd83e40efb503244e99f26993, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 21:03:08 CST 2020, views=12)
Blog(id=1ba71b26cae64a3ea32b330bff8ff007, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 21:08:31 CST 2020, views=12)
Blog(id=2595ec87a88f44c19fa15155c3511a94, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 21:09:49 CST 2020, views=12)
Blog(id=e051ba5328c44d58904f1fea3816850e, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 21:46:04 CST 2020, views=12)
>=====================
Blog(id=01, title=hello world, author=sogei, creatTime=Sat Jan 01 00:00:00 CST 2000, views=12)
Blog(id=02, title=idea how to use, author=liusann, creatTime=Sat May 01 10:05:00 CST 2004, views=12)
Blog(id=03, title=ä½ å¥½ä¸–ç•Œ, author=sogei, creatTime=Sun Jan 01 00:00:00 CST 2006, views=123)
Blog(id=04, title=MATLABä½¿ç”¨æ–¹æ³•, author=liusann, creatTime=Mon Jan 01 00:00:00 CST 2007, views=122)
Blog(id=05, title=WHAT IS JDBC, author=sogei, creatTime=Mon Oct 01 00:00:00 CST 2007, views=122)
Blog(id=06, title=INTO JDK1.8, author=liusann, creatTime=Tue Jun 01 10:05:00 CST 2004, views=123)
Blog(id=07, title=CREATE A WEBSITE BY USING BOOTSTRAP , author=sogei, creatTime=Wed Jan 01 00:00:00 CST 2020, views=122)
Blog(id=08, title=è·Ÿæ–°, author=so update, creatTime=Sun Apr 26 21:46:03 CST 2020, views=34)
Blog(id=a0e433ab127b488b9fe81d368907b72e, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 20:53:43 CST 2020, views=12)
Blog(id=7124224de5104fffbb9119a75219cb00, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 20:55:23 CST 2020, views=12)
Blog(id=85d4af0c11424a428d7db43e54ec55eb, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 20:56:15 CST 2020, views=12)
Blog(id=7334ed8c220e454f861909b32eb01da6, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 20:56:43 CST 2020, views=12)
Blog(id=872eac5dd83e40efb503244e99f26993, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 21:03:08 CST 2020, views=12)
Blog(id=1ba71b26cae64a3ea32b330bff8ff007, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 21:08:31 CST 2020, views=12)
Blog(id=2595ec87a88f44c19fa15155c3511a94, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 21:09:49 CST 2020, views=12)
Blog(id=e051ba5328c44d58904f1fea3816850e, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 21:46:04 CST 2020, views=12)
[2020/04/28 13:15:59,208]DEBUG:Closing JDBC Connection [com.mysql.cj.jdbc.ConnectionImpl@5fd4f8f5]
[2020/04/28 13:15:59,208]DEBUG:Returned connection 1607792885 to pool.
```

çœ‹ä¸‹é¢çš„å›¾ç‰‡å¯ä»¥æ¸…é™¤çš„çœ‹åˆ°sqlæŸ¥è¯¢åªç”¨äº†ä¸€æ¬¡ğŸ‘‡ï¼Œå´åšäº†ä¸¤æ¬¡ç›¸åŒçš„æŸ¥è¯¢åŠ¨ä½œ

<img src="http://q9efxddri.bkt.clouddn.com/20200428131917.png"/>

åœ¨åŸæœ‰çš„ä¸¤æ¬¡ç›¸åŒæŸ¥è¯¢åŸºç¡€ä¸Šï¼Œè¿›è¡Œä¸€æ¬¡æ›´æ–°æ“ä½œï¼Œç„¶åå†è¿›è¡Œä¸€æ¬¡æŸ¥è¯¢,javaä»£ç ğŸ‘‡

```java
/**
     *æ£€æµ‹ä¸€çº§ç¼“å­˜
     */
@Test
public void testOneH(){
    SqlSession sqlSession = SqlSessionUtil.getSqlSession();
    BlogMapper mapper = sqlSession.getMapper(BlogMapper.class);

    System.out.println(mapper.findAll());
    System.out.println(">=====================");
    //åœ¨è¿è¡Œä¸€émapper.findAll()
    System.out.println(mapper.findAll());
    //è¿›è¡Œupdateçš„æ“ä½œï¼Œè¿™å›åˆ·æ–°ç¼“å­˜
    Blog blog = new Blog("01", "hello", "æ›´æ–°éªŒè¯ç¼“å­˜", new Date(), 15);
    try {
        System.out.println(">======è¿›è¡Œupdateçš„æ“ä½œï¼Œè¿™å›åˆ·æ–°ç¼“å­˜");
        mapper.upadteSet(blog);
    } catch (Exception e) {
        e.printStackTrace();
    }
    System.out.println("ã€‹========è¿›è¡Œå’Œä¹‹å‰å®Œå…¨ç›¸åŒçš„æŸ¥è¯¢æ“ä½œ");
    System.out.println(mapper.findAll());

    sqlSession.close();
}
```

æ—¥å¿—ğŸ‘‡

```
[2020/04/28 13:38:15,192]DEBUG:Opening JDBC Connection
[2020/04/28 13:38:16,314]DEBUG:Created connection 1607792885.
[2020/04/28 13:38:16,319]DEBUG:==>  Preparing: select * from mybatisstudy.blog 
[2020/04/28 13:38:16,361]DEBUG:==> Parameters: 
[2020/04/28 13:38:16,409]DEBUG:<==      Total: 16
[Blog(id=01, title=hello, author=æ›´æ–°éªŒè¯ç¼“å­˜, creatTime=Tue Apr 28 13:33:26 CST 2020, views=15), Blog(id=02, title=idea how to use, author=liusann, creatTime=Sat May 01 10:05:00 CST 2004, views=12), Blog(id=03, title=ä½ å¥½ä¸–ç•Œ, author=sogei, creatTime=Sun Jan 01 00:00:00 CST 2006, views=123), Blog(id=04, title=MATLABä½¿ç”¨æ–¹æ³•, author=liusann, creatTime=Mon Jan 01 00:00:00 CST 2007, views=122), Blog(id=05, title=WHAT IS JDBC, author=sogei, creatTime=Mon Oct 01 00:00:00 CST 2007, views=122), Blog(id=06, title=INTO JDK1.8, author=liusann, creatTime=Tue Jun 01 10:05:00 CST 2004, views=123), Blog(id=07, title=CREATE A WEBSITE BY USING BOOTSTRAP , author=sogei, creatTime=Wed Jan 01 00:00:00 CST 2020, views=122), Blog(id=08, title=è·Ÿæ–°, author=so update, creatTime=Sun Apr 26 21:46:03 CST 2020, views=34), Blog(id=a0e433ab127b488b9fe81d368907b72e, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 20:53:43 CST 2020, views=12), Blog(id=7124224de5104fffbb9119a75219cb00, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 20:55:23 CST 2020, views=12), Blog(id=85d4af0c11424a428d7db43e54ec55eb, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 20:56:15 CST 2020, views=12), Blog(id=7334ed8c220e454f861909b32eb01da6, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 20:56:43 CST 2020, views=12), Blog(id=872eac5dd83e40efb503244e99f26993, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 21:03:08 CST 2020, views=12), Blog(id=1ba71b26cae64a3ea32b330bff8ff007, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 21:08:31 CST 2020, views=12), Blog(id=2595ec87a88f44c19fa15155c3511a94, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 21:09:49 CST 2020, views=12), Blog(id=e051ba5328c44d58904f1fea3816850e, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 21:46:04 CST 2020, views=12)]
>=====================
[Blog(id=01, title=hello, author=æ›´æ–°éªŒè¯ç¼“å­˜, creatTime=Tue Apr 28 13:33:26 CST 2020, views=15), Blog(id=02, title=idea how to use, author=liusann, creatTime=Sat May 01 10:05:00 CST 2004, views=12), Blog(id=03, title=ä½ å¥½ä¸–ç•Œ, author=sogei, creatTime=Sun Jan 01 00:00:00 CST 2006, views=123), Blog(id=04, title=MATLABä½¿ç”¨æ–¹æ³•, author=liusann, creatTime=Mon Jan 01 00:00:00 CST 2007, views=122), Blog(id=05, title=WHAT IS JDBC, author=sogei, creatTime=Mon Oct 01 00:00:00 CST 2007, views=122), Blog(id=06, title=INTO JDK1.8, author=liusann, creatTime=Tue Jun 01 10:05:00 CST 2004, views=123), Blog(id=07, title=CREATE A WEBSITE BY USING BOOTSTRAP , author=sogei, creatTime=Wed Jan 01 00:00:00 CST 2020, views=122), Blog(id=08, title=è·Ÿæ–°, author=so update, creatTime=Sun Apr 26 21:46:03 CST 2020, views=34), Blog(id=a0e433ab127b488b9fe81d368907b72e, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 20:53:43 CST 2020, views=12), Blog(id=7124224de5104fffbb9119a75219cb00, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 20:55:23 CST 2020, views=12), Blog(id=85d4af0c11424a428d7db43e54ec55eb, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 20:56:15 CST 2020, views=12), Blog(id=7334ed8c220e454f861909b32eb01da6, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 20:56:43 CST 2020, views=12), Blog(id=872eac5dd83e40efb503244e99f26993, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 21:03:08 CST 2020, views=12), Blog(id=1ba71b26cae64a3ea32b330bff8ff007, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 21:08:31 CST 2020, views=12), Blog(id=2595ec87a88f44c19fa15155c3511a94, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 21:09:49 CST 2020, views=12), Blog(id=e051ba5328c44d58904f1fea3816850e, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 21:46:04 CST 2020, views=12)]
>======è¿›è¡Œupdateçš„æ“ä½œï¼Œè¿™å›åˆ·æ–°ç¼“å­˜
[2020/04/28 13:38:16,437]DEBUG:==>  Preparing: update mybatisstudy.blog SET author=?, creat_time=?, title=?, views=? WHERE id=? 
[2020/04/28 13:38:16,440]DEBUG:==> Parameters: æ›´æ–°éªŒè¯ç¼“å­˜(String), 2020-04-28 13:38:16.41(Timestamp), hello(String), 15(Integer), 01(String)
[2020/04/28 13:38:16,449]DEBUG:<==    Updates: 1
ã€‹========è¿›è¡Œå’Œä¹‹å‰å®Œå…¨ç›¸åŒçš„æŸ¥è¯¢æ“ä½œ
[2020/04/28 13:38:16,450]DEBUG:==>  Preparing: select * from mybatisstudy.blog 
[2020/04/28 13:38:16,452]DEBUG:==> Parameters: 
[2020/04/28 13:38:16,458]DEBUG:<==      Total: 16
[Blog(id=01, title=hello, author=æ›´æ–°éªŒè¯ç¼“å­˜, creatTime=Tue Apr 28 13:38:16 CST 2020, views=15), Blog(id=02, title=idea how to use, author=liusann, creatTime=Sat May 01 10:05:00 CST 2004, views=12), Blog(id=03, title=ä½ å¥½ä¸–ç•Œ, author=sogei, creatTime=Sun Jan 01 00:00:00 CST 2006, views=123), Blog(id=04, title=MATLABä½¿ç”¨æ–¹æ³•, author=liusann, creatTime=Mon Jan 01 00:00:00 CST 2007, views=122), Blog(id=05, title=WHAT IS JDBC, author=sogei, creatTime=Mon Oct 01 00:00:00 CST 2007, views=122), Blog(id=06, title=INTO JDK1.8, author=liusann, creatTime=Tue Jun 01 10:05:00 CST 2004, views=123), Blog(id=07, title=CREATE A WEBSITE BY USING BOOTSTRAP , author=sogei, creatTime=Wed Jan 01 00:00:00 CST 2020, views=122), Blog(id=08, title=è·Ÿæ–°, author=so update, creatTime=Sun Apr 26 21:46:03 CST 2020, views=34), Blog(id=a0e433ab127b488b9fe81d368907b72e, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 20:53:43 CST 2020, views=12), Blog(id=7124224de5104fffbb9119a75219cb00, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 20:55:23 CST 2020, views=12), Blog(id=85d4af0c11424a428d7db43e54ec55eb, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 20:56:15 CST 2020, views=12), Blog(id=7334ed8c220e454f861909b32eb01da6, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 20:56:43 CST 2020, views=12), Blog(id=872eac5dd83e40efb503244e99f26993, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 21:03:08 CST 2020, views=12), Blog(id=1ba71b26cae64a3ea32b330bff8ff007, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 21:08:31 CST 2020, views=12), Blog(id=2595ec87a88f44c19fa15155c3511a94, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 21:09:49 CST 2020, views=12), Blog(id=e051ba5328c44d58904f1fea3816850e, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 21:46:04 CST 2020, views=12)]
[2020/04/28 13:38:16,459]DEBUG:Closing JDBC Connection [com.mysql.cj.jdbc.ConnectionImpl@5fd4f8f5]
[2020/04/28 13:38:16,459]DEBUG:Returned connection 1607792885 to pool.
```

å¯ä»¥æ¸…é™¤çš„å‘ç°è¿›è¡Œåˆ·æ–°æ“ä½œåï¼Œç¼“å­˜ä¹Ÿåˆ·æ–°äº†ï¼Œå’Œå®˜ç½‘ä¸Šè¯´çš„ä¸€è‡´

> - **æ˜ å°„è¯­å¥æ–‡ä»¶ä¸­çš„æ‰€æœ‰ select è¯­å¥çš„ç»“æœå°†ä¼šè¢«ç¼“å­˜ã€‚**
> - **æ˜ å°„è¯­å¥æ–‡ä»¶ä¸­çš„æ‰€æœ‰ insertã€update å’Œ delete è¯­å¥ä¼šåˆ·æ–°ç¼“å­˜ã€‚**

#### æ³¨æ„ï¼šæ‰‹åŠ¨æ¸…ç†ç¼“å­˜

```java
sqlSession.clearCache();
```

#### **ä¸€çº§ç¼“å­˜æ›´æ–°çš„å‡ ä¸ªæ¡ä»¶**

- è¿›è¡Œå¢ã€æ”¹ã€åˆ æ“ä½œ
- æ‰‹åŠ¨æ¸…ç†ç¼“å­˜  `sqlSession.clearCache();`

### 13.2 äºŒçº§ç¼“å­˜

> äºŒçº§ç¼“å­˜æ˜¯**mapperçº§åˆ«çš„ç¼“å­˜**ï¼Œå¤šä¸ªSqlSessionå»æ“ä½œåŒä¸€ä¸ªMapperçš„sqlè¯­å¥ï¼Œå¤šä¸ªSqlSessionå»æ“ä½œæ•°æ®åº“å¾—åˆ°æ•°æ®ä¼šå­˜åœ¨äºŒçº§ç¼“å­˜åŒºåŸŸï¼Œå¤šä¸ªSqlSessionå¯ä»¥å…±ç”¨äºŒçº§ç¼“å­˜ï¼ŒäºŒçº§ç¼“å­˜æ˜¯è·¨SqlSessionçš„ã€‚
>
> **äºŒçº§ç¼“å­˜æ˜¯å¤šä¸ªSqlSessionå…±äº«çš„**ï¼Œå…¶ä½œç”¨åŸŸæ˜¯mapperçš„**åŒä¸€ä¸ªnamespace**ï¼Œä¸åŒçš„sqlSessionä¸¤æ¬¡æ‰§è¡Œç›¸åŒnamespaceä¸‹çš„sqlè¯­å¥ä¸”å‘sqlä¸­ä¼ é€’å‚æ•°ä¹Ÿç›¸åŒå³æœ€ç»ˆæ‰§è¡Œç›¸åŒçš„sqlè¯­å¥ï¼Œç¬¬ä¸€æ¬¡æ‰§è¡Œå®Œæ¯•ä¼šå°†æ•°æ®åº“ä¸­æŸ¥è¯¢çš„æ•°æ®å†™åˆ°ç¼“å­˜ï¼ˆå†…å­˜ï¼‰ï¼Œç¬¬äºŒæ¬¡ä¼šä»ç¼“å­˜ä¸­è·å–æ•°æ®å°†ä¸å†ä»æ•°æ®åº“æŸ¥è¯¢ï¼Œä»è€Œæé«˜æŸ¥è¯¢æ•ˆç‡ã€‚Mybatis**é»˜è®¤æ²¡æœ‰å¼€å¯äºŒçº§ç¼“å­˜éœ€è¦åœ¨settingå…¨å±€å‚æ•°ä¸­é…ç½®å¼€å¯äºŒçº§ç¼“å­˜ã€‚**
>
> ------------------------------------------------
> ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºCSDNåšä¸»ã€ŒåŒæ–œæ å°‘å¹´ã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚
> åŸæ–‡é“¾æ¥ï¼šhttps://blog.csdn.net/u012373815/article/details/47069223



> é»˜è®¤æƒ…å†µä¸‹ï¼Œ**åªå¯ç”¨äº†æœ¬åœ°çš„ä¼šè¯ç¼“å­˜ï¼Œå®ƒä»…ä»…å¯¹ä¸€ä¸ªä¼šè¯ä¸­çš„æ•°æ®è¿›è¡Œç¼“å­˜ã€‚** è¦å¯ç”¨å…¨å±€çš„äºŒçº§ç¼“å­˜ï¼Œåªéœ€è¦åœ¨ä½ çš„ SQL æ˜ å°„æ–‡ä»¶ä¸­æ·»åŠ ä¸€è¡Œï¼š
>
> ```xml
> <cache/>
> ```
>
> æ¥æº https://mybatis.org/mybatis-3/zh/sqlmap-xml.html

#### 13.2.1 å¼€å¯äºŒçº§ç¼“å­˜çš„æ­¥éª¤

- ç¬¬ä¸€æ­¥ åœ¨config.xmlé‡Œé¢ğŸ‘‡ï¼Œå…¶å®`cacheEnabled`æ˜¯é»˜è®¤å¼€å¯çš„ï¼Œä¸ºäº†ä»£ç çš„å¯è¯»æ€§ï¼Œåªè¦ç”¨äºŒçº§ç¼“å­˜ï¼Œå°±å¢åŠ è¿™ä¸ªsetting

  ```xml
  <!--        å¼€å¯å…¨å±€ç¼“å­˜ï¼Œå…¶å®æ˜¯é»˜è®¤å¼€å¯-->
  <setting name="cacheEnabled" value="true"/>
  ```

- ç¬¬äºŒæ­¥ åœ¨mapper.xmlé‡Œé¢ğŸ‘‡ï¼Œå¼€å¯äºŒçº§ç¼“å­˜

  ```xml
  <cache/>
  ```

#### 13.2.2 `cache`é…ç½®

> è¿™äº›å±æ€§å¯ä»¥é€šè¿‡ cache å…ƒç´ çš„å±æ€§æ¥ä¿®æ”¹ã€‚æ¯”å¦‚ï¼š
>
> ```xml
> <cache
>   eviction="FIFO"
>   flushInterval="60000"
>   size="512"
>   readOnly="true"/>
> ```
>
> è¿™ä¸ªæ›´é«˜çº§çš„é…ç½®åˆ›å»ºäº†ä¸€ä¸ª FIFO ç¼“å­˜ï¼Œæ¯éš” 60 ç§’åˆ·æ–°ï¼Œæœ€å¤šå¯ä»¥å­˜å‚¨ç»“æœå¯¹è±¡æˆ–åˆ—è¡¨çš„ 512 ä¸ªå¼•ç”¨ï¼Œè€Œä¸”è¿”å›çš„å¯¹è±¡è¢«è®¤ä¸ºæ˜¯åªè¯»çš„ï¼Œå› æ­¤å¯¹å®ƒä»¬è¿›è¡Œä¿®æ”¹å¯èƒ½ä¼šåœ¨ä¸åŒçº¿ç¨‹ä¸­çš„è°ƒç”¨è€…äº§ç”Ÿå†²çªã€‚
>
> å¯ç”¨çš„æ¸…é™¤ç­–ç•¥æœ‰ï¼š
>
> - `LRU` â€“ æœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼šç§»é™¤æœ€é•¿æ—¶é—´ä¸è¢«ä½¿ç”¨çš„å¯¹è±¡ã€‚
> - `FIFO` â€“ å…ˆè¿›å…ˆå‡ºï¼šæŒ‰å¯¹è±¡è¿›å…¥ç¼“å­˜çš„é¡ºåºæ¥ç§»é™¤å®ƒä»¬ã€‚
> - `SOFT` â€“ è½¯å¼•ç”¨ï¼šåŸºäºåƒåœ¾å›æ”¶å™¨çŠ¶æ€å’Œè½¯å¼•ç”¨è§„åˆ™ç§»é™¤å¯¹è±¡ã€‚
> - `WEAK` â€“ å¼±å¼•ç”¨ï¼šæ›´ç§¯æåœ°åŸºäºåƒåœ¾æ”¶é›†å™¨çŠ¶æ€å’Œå¼±å¼•ç”¨è§„åˆ™ç§»é™¤å¯¹è±¡ã€‚
>
> é»˜è®¤çš„æ¸…é™¤ç­–ç•¥æ˜¯ LRUã€‚

#### 13.2.3 å®ä¾‹

javaä»£ç ğŸ‘‡

```java
@Test
public void testTwoH() {
    //å®šä¹‰ä¸¤ä¸ªsqlsession
    SqlSession sqlSession1 = SqlSessionUtil.getSqlSession();
    SqlSession sqlSession2 = SqlSessionUtil.getSqlSession();
    //åˆ†åˆ«è¿›è¡Œç›¸åŒçš„æŸ¥è¯¢æ“ä½œ
    BlogMapper mapper = sqlSession1.getMapper(BlogMapper.class);
    System.out.println(mapper.findAll());
    //å…³é—­ç¬¬ä¸€ä¸ªsqlsessionï¼Œä¸€çº§ç¼“å­˜æ­»æ‰ï¼ŒåŸå…ˆä¸€çº§ç¼“å­˜ä¸­çš„å†…å®¹å­˜å…¥äºŒçº§ç¼“å­˜
    sqlSession1.close();
    BlogMapper mapper1 = sqlSession2.getMapper(BlogMapper.class);
    System.out.println(mapper1.findAll());
    //        sqlSession1.close();
    sqlSession2.close();

}
```

æ—¥å¿—ğŸ‘‡

```
[2020/04/28 14:34:23,123]DEBUG:Opening JDBC Connection
[2020/04/28 14:34:24,132]DEBUG:Created connection 212683148.
[2020/04/28 14:34:24,136]DEBUG:==>  Preparing: select * from mybatisstudy.blog 
[2020/04/28 14:34:24,162]DEBUG:==> Parameters: 
[2020/04/28 14:34:24,185]DEBUG:<==      Total: 16
[Blog(id=01, title=hello, author=æ›´æ–°éªŒè¯ç¼“å­˜, creatTime=Tue Apr 28 14:24:39 CST 2020, views=15), Blog(id=02, title=idea how to use, author=liusann, creatTime=Sat May 01 10:05:00 CST 2004, views=12), Blog(id=03, title=ä½ å¥½ä¸–ç•Œ, author=sogei, creatTime=Sun Jan 01 00:00:00 CST 2006, views=123), Blog(id=04, title=MATLABä½¿ç”¨æ–¹æ³•, author=liusann, creatTime=Mon Jan 01 00:00:00 CST 2007, views=122), Blog(id=05, title=WHAT IS JDBC, author=sogei, creatTime=Mon Oct 01 00:00:00 CST 2007, views=122), Blog(id=06, title=INTO JDK1.8, author=liusann, creatTime=Tue Jun 01 10:05:00 CST 2004, views=123), Blog(id=07, title=CREATE A WEBSITE BY USING BOOTSTRAP , author=sogei, creatTime=Wed Jan 01 00:00:00 CST 2020, views=122), Blog(id=08, title=è·Ÿæ–°, author=so update, creatTime=Sun Apr 26 21:46:03 CST 2020, views=34), Blog(id=a0e433ab127b488b9fe81d368907b72e, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 20:53:43 CST 2020, views=12), Blog(id=7124224de5104fffbb9119a75219cb00, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 20:55:23 CST 2020, views=12), Blog(id=85d4af0c11424a428d7db43e54ec55eb, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 20:56:15 CST 2020, views=12), Blog(id=7334ed8c220e454f861909b32eb01da6, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 20:56:43 CST 2020, views=12), Blog(id=872eac5dd83e40efb503244e99f26993, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 21:03:08 CST 2020, views=12), Blog(id=1ba71b26cae64a3ea32b330bff8ff007, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 21:08:31 CST 2020, views=12), Blog(id=2595ec87a88f44c19fa15155c3511a94, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 21:09:49 CST 2020, views=12), Blog(id=e051ba5328c44d58904f1fea3816850e, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 21:46:04 CST 2020, views=12)]
[2020/04/28 14:34:24,186]DEBUG:Closing JDBC Connection [com.mysql.cj.jdbc.ConnectionImpl@cad498c]
[2020/04/28 14:34:24,186]DEBUG:Returned connection 212683148 to pool.
[2020/04/28 14:34:24,186]DEBUG:Cache Hit Ratio [ssm.suyuesheng.mapper.BlogMapper]: 0.5
[Blog(id=01, title=hello, author=æ›´æ–°éªŒè¯ç¼“å­˜, creatTime=Tue Apr 28 14:24:39 CST 2020, views=15), Blog(id=02, title=idea how to use, author=liusann, creatTime=Sat May 01 10:05:00 CST 2004, views=12), Blog(id=03, title=ä½ å¥½ä¸–ç•Œ, author=sogei, creatTime=Sun Jan 01 00:00:00 CST 2006, views=123), Blog(id=04, title=MATLABä½¿ç”¨æ–¹æ³•, author=liusann, creatTime=Mon Jan 01 00:00:00 CST 2007, views=122), Blog(id=05, title=WHAT IS JDBC, author=sogei, creatTime=Mon Oct 01 00:00:00 CST 2007, views=122), Blog(id=06, title=INTO JDK1.8, author=liusann, creatTime=Tue Jun 01 10:05:00 CST 2004, views=123), Blog(id=07, title=CREATE A WEBSITE BY USING BOOTSTRAP , author=sogei, creatTime=Wed Jan 01 00:00:00 CST 2020, views=122), Blog(id=08, title=è·Ÿæ–°, author=so update, creatTime=Sun Apr 26 21:46:03 CST 2020, views=34), Blog(id=a0e433ab127b488b9fe81d368907b72e, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 20:53:43 CST 2020, views=12), Blog(id=7124224de5104fffbb9119a75219cb00, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 20:55:23 CST 2020, views=12), Blog(id=85d4af0c11424a428d7db43e54ec55eb, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 20:56:15 CST 2020, views=12), Blog(id=7334ed8c220e454f861909b32eb01da6, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 20:56:43 CST 2020, views=12), Blog(id=872eac5dd83e40efb503244e99f26993, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 21:03:08 CST 2020, views=12), Blog(id=1ba71b26cae64a3ea32b330bff8ff007, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 21:08:31 CST 2020, views=12), Blog(id=2595ec87a88f44c19fa15155c3511a94, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 21:09:49 CST 2020, views=12), Blog(id=e051ba5328c44d58904f1fea3816850e, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 21:46:04 CST 2020, views=12)]
```

å¯ä»¥çœ‹åˆ°åŒä¸€mapperä¸‹çš„ä¸åŒsqlsessionä½¿ç”¨åŒä¸€ç¼“å­˜

##### **æ³¨æ„ï¼šé‡ç‚¹ï¼šäºŒçº§ç¼“å­˜éœ€è¦ä¸€çº§ç¼“å­˜æ­»æ‰åæ‰ä¼šæœ‰æ•ˆ**

<img src="http://q9efxddri.bkt.clouddn.com/20200428150739.png"/>

å¦‚æœåƒä¸‹é¢ä¸€æ ·ï¼Œä¸€çº§ç¼“å­˜æ²¡æœ‰æ­»ï¼Œé‚£ä¹ˆäºŒçº§ç¼“å­˜å°±ä¸ä¼šæœ‰ä¸œè¥¿ğŸ‘‡

```java
@Test
public void testTwoH() {
    //å®šä¹‰ä¸¤ä¸ªsqlsession
    SqlSession sqlSession1 = SqlSessionUtil.getSqlSession();
    SqlSession sqlSession2 = SqlSessionUtil.getSqlSession();
    //åˆ†åˆ«è¿›è¡Œç›¸åŒçš„æŸ¥è¯¢æ“ä½œ
    //sqlsession1æ“ä½œ
    BlogMapper mapper = sqlSession1.getMapper(BlogMapper.class);
    System.out.println(mapper.findAll());
    //sqlsession2æ“ä½œ
    BlogMapper mapper1 = sqlSession2.getMapper(BlogMapper.class);
    System.out.println(mapper1.findAll());
    //åœ¨è¿™ä¹‹å‰ï¼Œæ²¡æœ‰ä¸œè¥¿å­˜å…¥äºŒçº§ç¼“å­˜
    sqlSession1.close();
    sqlSession2.close();
}
```

æ—¥å¿—ğŸ‘‡ï¼Œå¯ä»¥çœ‹åˆ°æœ‰ä¸¤æ¬¡æ•°æ®åº“sqlæŸ¥è¯¢æ“ä½œï¼Œå³ä½¿æ˜¯ç›¸åŒçš„sqlè¯­å¥

```
[2020/04/28 15:15:31,205]DEBUG:Opening JDBC Connection
[2020/04/28 15:15:32,280]DEBUG:Created connection 212683148.
[2020/04/28 15:15:32,284]DEBUG:==>  Preparing: select * from mybatisstudy.blog 
[2020/04/28 15:15:32,310]DEBUG:==> Parameters: 
[2020/04/28 15:15:32,334]DEBUG:<==      Total: 16
[Blog(id=01, title=hello, author=æ›´æ–°éªŒè¯ç¼“å­˜, creatTime=Tue Apr 28 14:24:39 CST 2020, views=15), Blog(id=02, title=idea how to use, author=liusann, creatTime=Sat May 01 10:05:00 CST 2004, views=12), Blog(id=03, title=ä½ å¥½ä¸–ç•Œ, author=sogei, creatTime=Sun Jan 01 00:00:00 CST 2006, views=123), Blog(id=04, title=MATLABä½¿ç”¨æ–¹æ³•, author=liusann, creatTime=Mon Jan 01 00:00:00 CST 2007, views=122), Blog(id=05, title=WHAT IS JDBC, author=sogei, creatTime=Mon Oct 01 00:00:00 CST 2007, views=122), Blog(id=06, title=INTO JDK1.8, author=liusann, creatTime=Tue Jun 01 10:05:00 CST 2004, views=123), Blog(id=07, title=CREATE A WEBSITE BY USING BOOTSTRAP , author=sogei, creatTime=Wed Jan 01 00:00:00 CST 2020, views=122), Blog(id=08, title=è·Ÿæ–°, author=so update, creatTime=Sun Apr 26 21:46:03 CST 2020, views=34), Blog(id=a0e433ab127b488b9fe81d368907b72e, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 20:53:43 CST 2020, views=12), Blog(id=7124224de5104fffbb9119a75219cb00, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 20:55:23 CST 2020, views=12), Blog(id=85d4af0c11424a428d7db43e54ec55eb, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 20:56:15 CST 2020, views=12), Blog(id=7334ed8c220e454f861909b32eb01da6, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 20:56:43 CST 2020, views=12), Blog(id=872eac5dd83e40efb503244e99f26993, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 21:03:08 CST 2020, views=12), Blog(id=1ba71b26cae64a3ea32b330bff8ff007, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 21:08:31 CST 2020, views=12), Blog(id=2595ec87a88f44c19fa15155c3511a94, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 21:09:49 CST 2020, views=12), Blog(id=e051ba5328c44d58904f1fea3816850e, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 21:46:04 CST 2020, views=12)]
[2020/04/28 15:15:32,335]DEBUG:Cache Hit Ratio [ssm.suyuesheng.mapper.BlogMapper]: 0.0
[2020/04/28 15:15:32,335]DEBUG:Opening JDBC Connection
[2020/04/28 15:15:32,370]DEBUG:Created connection 1912960603.
[2020/04/28 15:15:32,370]DEBUG:==>  Preparing: select * from mybatisstudy.blog 
[2020/04/28 15:15:32,370]DEBUG:==> Parameters: 
[2020/04/28 15:15:32,374]DEBUG:<==      Total: 16
[Blog(id=01, title=hello, author=æ›´æ–°éªŒè¯ç¼“å­˜, creatTime=Tue Apr 28 14:24:39 CST 2020, views=15), Blog(id=02, title=idea how to use, author=liusann, creatTime=Sat May 01 10:05:00 CST 2004, views=12), Blog(id=03, title=ä½ å¥½ä¸–ç•Œ, author=sogei, creatTime=Sun Jan 01 00:00:00 CST 2006, views=123), Blog(id=04, title=MATLABä½¿ç”¨æ–¹æ³•, author=liusann, creatTime=Mon Jan 01 00:00:00 CST 2007, views=122), Blog(id=05, title=WHAT IS JDBC, author=sogei, creatTime=Mon Oct 01 00:00:00 CST 2007, views=122), Blog(id=06, title=INTO JDK1.8, author=liusann, creatTime=Tue Jun 01 10:05:00 CST 2004, views=123), Blog(id=07, title=CREATE A WEBSITE BY USING BOOTSTRAP , author=sogei, creatTime=Wed Jan 01 00:00:00 CST 2020, views=122), Blog(id=08, title=è·Ÿæ–°, author=so update, creatTime=Sun Apr 26 21:46:03 CST 2020, views=34), Blog(id=a0e433ab127b488b9fe81d368907b72e, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 20:53:43 CST 2020, views=12), Blog(id=7124224de5104fffbb9119a75219cb00, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 20:55:23 CST 2020, views=12), Blog(id=85d4af0c11424a428d7db43e54ec55eb, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 20:56:15 CST 2020, views=12), Blog(id=7334ed8c220e454f861909b32eb01da6, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 20:56:43 CST 2020, views=12), Blog(id=872eac5dd83e40efb503244e99f26993, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 21:03:08 CST 2020, views=12), Blog(id=1ba71b26cae64a3ea32b330bff8ff007, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 21:08:31 CST 2020, views=12), Blog(id=2595ec87a88f44c19fa15155c3511a94, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 21:09:49 CST 2020, views=12), Blog(id=e051ba5328c44d58904f1fea3816850e, title=hehe, author=ä¸ºäº†æ›´æ–°, creatTime=Sun Apr 26 21:46:04 CST 2020, views=12)]
[2020/04/28 15:15:32,374]DEBUG:Closing JDBC Connection [com.mysql.cj.jdbc.ConnectionImpl@cad498c]
[2020/04/28 15:15:32,374]DEBUG:Returned connection 212683148 to pool.
[2020/04/28 15:15:32,374]DEBUG:Closing JDBC Connection [com.mysql.cj.jdbc.ConnectionImpl@7205765b]
[2020/04/28 15:15:32,374]DEBUG:Returned connection 1912960603 to pool.
```

##### **è¯»å–ç¼“å­˜çš„é¡ºåº**

1. æŸ¥çœ‹äºŒçº§ç¼“å­˜æœ‰æ²¡æœ‰
2. å¦‚æœäºŒçº§ç¼“å­˜æ²¡æœ‰å°±æŸ¥çœ‹ä¸€çº§ç¼“å­˜
3. å¦‚æœä¸€çº§ç¼“å­˜ä¹Ÿæ²¡æœ‰å°±æ‰§è¡Œæ•°æ®åº“çš„è¯»å†™

##### æŸä¸€æ¡è¯­å¥ä¸æƒ³ç¼“å­˜ï¼ŸæŸä¸€æ¡selectè¯­å¥æƒ³æ‰§è¡Œåå°±æ›´æ–°ç¼“å­˜ï¼Ÿ(æŒ‡çš„æ˜¯äºŒçº§ç¼“å­˜)

> è¯·æ³¨æ„ï¼Œç¼“å­˜çš„é…ç½®å’Œç¼“å­˜å®ä¾‹ä¼šè¢«ç»‘å®šåˆ° SQL æ˜ å°„æ–‡ä»¶çš„å‘½åç©ºé—´ä¸­ã€‚ å› æ­¤ï¼ŒåŒä¸€å‘½åç©ºé—´ä¸­çš„æ‰€æœ‰è¯­å¥å’Œç¼“å­˜å°†é€šè¿‡å‘½åç©ºé—´ç»‘å®šåœ¨ä¸€èµ·ã€‚ **æ¯æ¡è¯­å¥å¯ä»¥è‡ªå®šä¹‰ä¸ç¼“å­˜äº¤äº’çš„æ–¹å¼ï¼Œæˆ–å°†å®ƒä»¬å®Œå…¨æ’é™¤äºç¼“å­˜ä¹‹å¤–ï¼Œè¿™å¯ä»¥é€šè¿‡åœ¨æ¯æ¡è¯­å¥ä¸Šä½¿ç”¨ä¸¤ä¸ªç®€å•å±æ€§æ¥è¾¾æˆã€‚** é»˜è®¤æƒ…å†µä¸‹ï¼Œè¯­å¥ä¼šè¿™æ ·æ¥é…ç½®ï¼š
>
> ```xml
> <select ... flushCache="false" useCache="true"/>
> <insert ... flushCache="true"/>
> <update ... flushCache="true"/>
> <delete ... flushCache="true"/>
> ```
>
> é‰´äºè¿™æ˜¯é»˜è®¤è¡Œä¸ºï¼Œæ˜¾ç„¶ä½ æ°¸è¿œä¸åº”è¯¥ä»¥è¿™æ ·çš„æ–¹å¼æ˜¾å¼é…ç½®ä¸€æ¡è¯­å¥ã€‚ä½†å¦‚æœä½ æƒ³æ”¹å˜é»˜è®¤çš„è¡Œä¸ºï¼Œåªéœ€è¦è®¾ç½® flushCache å’Œ useCache å±æ€§ã€‚**æ¯”å¦‚ï¼ŒæŸäº›æƒ…å†µä¸‹ä½ å¯èƒ½å¸Œæœ›ç‰¹å®š select è¯­å¥çš„ç»“æœæ’é™¤äºç¼“å­˜ä¹‹å¤–ï¼Œæˆ–å¸Œæœ›ä¸€æ¡ select è¯­å¥æ¸…ç©ºç¼“å­˜ã€‚ç±»ä¼¼åœ°ï¼Œä½ å¯èƒ½å¸Œæœ›æŸäº› update è¯­å¥æ‰§è¡Œæ—¶ä¸è¦åˆ·æ–°ç¼“å­˜ã€‚**

### 13.3 è‡ªå®šä¹‰ç¼“å­˜ ehcache





















